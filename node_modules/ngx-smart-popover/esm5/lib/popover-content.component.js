/**
 * @fileoverview added by tsickle
 * Generated from: lib/popover-content.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * This is a continuation of ngx-popover
 * @Reference {github} https://github.com/pleerock/ngx-popover
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, Renderer2, ViewChild, HostListener } from '@angular/core';
import { PopoverPlacement } from './popover.placement';
var PopoverContentComponent = /** @class */ (function () {
    // -------------------------------------------------------------------------
    // Constructor
    // -------------------------------------------------------------------------
    function PopoverContentComponent(element, cdr, renderer) {
        var _this = this;
        this.element = element;
        this.cdr = cdr;
        this.renderer = renderer;
        this.placement = PopoverPlacement.Top;
        this.animation = true;
        this.closeOnClickOutside = false;
        this.closeOnMouseOutside = false;
        this.appendToBody = false;
        this.size = 'small';
        this.onCloseFromOutside = new EventEmitter();
        this.top = -10000;
        this.left = -10000;
        this.isIn = false;
        this.opacity = 0;
        this.transitionEnabled = false;
        this.windowWidth = window.innerWidth;
        this.windowHeight = window.innerHeight;
        // -------------------------------------------------------------------------
        // Anonymous
        // -------------------------------------------------------------------------
        /**
         * Closes dropdown if user clicks outside of this directive.
         */
        this.onDocumentMouseDown = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            /** @type {?} */
            var element = _this.element.nativeElement;
            if (!element || !_this.popover) {
                return;
            }
            if (element.contains(event.target) || _this.popover.getElement().contains(event.target)) {
                return;
            }
            _this.onCloseFromOutside.emit(undefined);
        });
    }
    // -------------------------------------------------------------------------
    // Lifecycle callbacks
    // -------------------------------------------------------------------------
    // -------------------------------------------------------------------------
    // Lifecycle callbacks
    // -------------------------------------------------------------------------
    /**
     * @return {?}
     */
    PopoverContentComponent.prototype.ngAfterViewInit = 
    // -------------------------------------------------------------------------
    // Lifecycle callbacks
    // -------------------------------------------------------------------------
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.closeOnClickOutside) {
            this.listenClickFunc = this.renderer.listen('document', 'mousedown', (/**
             * @param {?} event
             * @return {?}
             */
            function (event) { return _this.onDocumentMouseDown(event); }));
        }
        if (this.closeOnMouseOutside) {
            this.listenMouseFunc = this.renderer.listen('document', 'mouseover', (/**
             * @param {?} event
             * @return {?}
             */
            function (event) { return _this.onDocumentMouseDown(event); }));
        }
        // Always close on mobile touch event outside.
        this.listenTouchFunc = this.renderer.listen('document', 'touchstart', (/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return _this.onDocumentMouseDown(event); }));
        this.show();
        this.cdr.detectChanges();
    };
    /**
     * @return {?}
     */
    PopoverContentComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.closeOnClickOutside && this.listenClickFunc) {
            this.listenClickFunc();
        }
        if (this.closeOnMouseOutside && this.listenMouseFunc) {
            this.listenMouseFunc();
        }
        if (!!this.listenTouchFunc) {
            this.listenTouchFunc();
        }
    };
    // -------------------------------------------------------------------------
    // Public Methods
    // -------------------------------------------------------------------------
    // -------------------------------------------------------------------------
    // Public Methods
    // -------------------------------------------------------------------------
    /**
     * @param {?} event
     * @return {?}
     */
    PopoverContentComponent.prototype.onResize = 
    // -------------------------------------------------------------------------
    // Public Methods
    // -------------------------------------------------------------------------
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.windowWidth = window.innerWidth;
        this.windowHeight = window.innerHeight;
    };
    /**
     * @return {?}
     */
    PopoverContentComponent.prototype.updatePosition = /**
     * @return {?}
     */
    function () {
        // if visible, reposition
        if (this.opacity) {
            /** @type {?} */
            var p = this.positionElements(this.popover.getElement(), this.popoverDiv.nativeElement, this.placement);
            this.top = p.top;
            this.left = p.left;
        }
    };
    /**
     * @return {?}
     */
    PopoverContentComponent.prototype.show = /**
     * @return {?}
     */
    function () {
        if (!this.popover || !this.popover.getElement()) {
            return;
        }
        /** @type {?} */
        var p = this.positionElements(this.popover.getElement(), this.popoverDiv.nativeElement, this.placement);
        this.top = p.top;
        this.left = p.left;
        this.isIn = true;
        this.transitionEnabled = true;
        this.opacity = 1;
    };
    /**
     * @return {?}
     */
    PopoverContentComponent.prototype.hide = /**
     * @return {?}
     */
    function () {
        this.top = -10000;
        this.left = -10000;
        this.isIn = true;
        this.popover.hide();
    };
    /**
     * @return {?}
     */
    PopoverContentComponent.prototype.hideFromPopover = /**
     * @return {?}
     */
    function () {
        this.top = -10000;
        this.left = -10000;
        this.isIn = true;
        this.transitionEnabled = false;
        this.opacity = 0;
    };
    // -------------------------------------------------------------------------
    // Protected Methods
    // -------------------------------------------------------------------------
    // -------------------------------------------------------------------------
    // Protected Methods
    // -------------------------------------------------------------------------
    /**
     * @protected
     * @param {?} hostEl
     * @param {?} targetEl
     * @param {?} positionStr
     * @param {?=} appendToBody
     * @return {?}
     */
    PopoverContentComponent.prototype.positionElements = 
    // -------------------------------------------------------------------------
    // Protected Methods
    // -------------------------------------------------------------------------
    /**
     * @protected
     * @param {?} hostEl
     * @param {?} targetEl
     * @param {?} positionStr
     * @param {?=} appendToBody
     * @return {?}
     */
    function (hostEl, targetEl, positionStr, appendToBody) {
        if (appendToBody === void 0) { appendToBody = false; }
        /** @type {?} */
        var positionStrParts = ((/** @type {?} */ (positionStr))).split(' ');
        /** @type {?} */
        var pos0 = positionStrParts[0];
        /** @type {?} */
        var pos1 = positionStrParts[1] || 'center';
        /** @type {?} */
        var hostElPos = this.appendToBody || appendToBody ? this.offset(hostEl) : this.position(hostEl);
        /** @type {?} */
        var targetElWidth = targetEl.offsetWidth;
        /** @type {?} */
        var targetElHeight = targetEl.offsetHeight;
        this.effectivePlacement = pos0 = this.getEffectivePlacement(pos0, hostEl, targetEl);
        /** @type {?} */
        var shiftWidth = {
            center: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left + hostElPos.width / 2 - targetElWidth / 2;
            }),
            left: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left;
            }),
            right: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left + hostElPos.width;
            }),
            topOrBottomRight: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left + hostElPos.width / 2;
            }),
            topOrBottomLeft: (/**
             * @return {?}
             */
            function () {
                return hostElPos.left - targetElWidth + hostElPos.width / 2;
            })
        };
        /** @type {?} */
        var shiftHeight = {
            center: (/**
             * @return {?}
             */
            function () {
                return hostElPos.top + hostElPos.height / 2 - targetElHeight / 2;
            }),
            top: (/**
             * @return {?}
             */
            function () {
                return hostElPos.top;
            }),
            bottom: (/**
             * @return {?}
             */
            function () {
                return hostElPos.top + hostElPos.height;
            })
        };
        /** @type {?} */
        var targetElPos;
        switch (pos0) {
            case PopoverPlacement.Right:
                targetElPos = {
                    top: shiftHeight[pos1](),
                    left: shiftWidth[pos0]()
                };
                break;
            case PopoverPlacement.Left:
                targetElPos = {
                    top: shiftHeight[pos1](),
                    left: hostElPos.left - targetElWidth
                };
                break;
            case PopoverPlacement.Bottom:
                targetElPos = {
                    top: shiftHeight[pos0](),
                    left: shiftWidth[pos1]()
                };
                break;
            case PopoverPlacement.TopLeft:
                targetElPos = {
                    top: hostElPos.top - targetElHeight,
                    left: shiftWidth['topOrBottomLeft']()
                };
                break;
            case PopoverPlacement.TopRight:
                targetElPos = {
                    top: hostElPos.top - targetElHeight,
                    left: shiftWidth['topOrBottomRight']()
                };
                break;
            case PopoverPlacement.BottomLeft:
                targetElPos = {
                    top: shiftHeight[PopoverPlacement.Bottom](),
                    left: shiftWidth['topOrBottomLeft']()
                };
                break;
            case PopoverPlacement.BottomRight:
                targetElPos = {
                    top: shiftHeight[PopoverPlacement.Bottom](),
                    left: shiftWidth['topOrBottomRight']()
                };
                break;
            default:
                targetElPos = {
                    top: hostElPos.top - targetElHeight,
                    left: shiftWidth[pos1]()
                };
                break;
        }
        return targetElPos;
    };
    /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    PopoverContentComponent.prototype.position = /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    function (nativeEl) {
        /** @type {?} */
        var offsetParentBCR = { top: 0, left: 0 };
        /** @type {?} */
        var elBCR = this.offset(nativeEl);
        /** @type {?} */
        var offsetParentEl = this.parentOffsetEl(nativeEl);
        if (offsetParentEl !== window.document) {
            offsetParentBCR = this.offset(offsetParentEl);
            offsetParentBCR.top += offsetParentEl.clientTop - offsetParentEl.scrollTop;
            offsetParentBCR.left += offsetParentEl.clientLeft - offsetParentEl.scrollLeft;
        }
        /** @type {?} */
        var boundingClientRect = nativeEl.getBoundingClientRect();
        return {
            width: boundingClientRect.width || nativeEl.offsetWidth,
            height: boundingClientRect.height || nativeEl.offsetHeight,
            top: elBCR.top - offsetParentBCR.top,
            left: elBCR.left - offsetParentBCR.left
        };
    };
    /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    PopoverContentComponent.prototype.offset = /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    function (nativeEl) {
        /** @type {?} */
        var boundingClientRect = nativeEl.getBoundingClientRect();
        return {
            width: boundingClientRect.width || nativeEl.offsetWidth,
            height: boundingClientRect.height || nativeEl.offsetHeight,
            top: boundingClientRect.top + (window.pageYOffset || window.document.documentElement.scrollTop),
            left: boundingClientRect.left + (window.pageXOffset || window.document.documentElement.scrollLeft)
        };
    };
    /**
     * @protected
     * @param {?} nativeEl
     * @param {?} cssProp
     * @return {?}
     */
    PopoverContentComponent.prototype.getStyle = /**
     * @protected
     * @param {?} nativeEl
     * @param {?} cssProp
     * @return {?}
     */
    function (nativeEl, cssProp) {
        if (((/** @type {?} */ (nativeEl))).currentStyle) { // IE
            return ((/** @type {?} */ (nativeEl))).currentStyle[cssProp];
        }
        if (window.getComputedStyle) {
            return ((/** @type {?} */ (window.getComputedStyle)))(nativeEl)[cssProp];
        }
        // finally try and get inline style
        return ((/** @type {?} */ (nativeEl.style)))[cssProp];
    };
    /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    PopoverContentComponent.prototype.isStaticPositioned = /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    function (nativeEl) {
        return (this.getStyle(nativeEl, 'position') || 'static') === 'static';
    };
    /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    PopoverContentComponent.prototype.parentOffsetEl = /**
     * @protected
     * @param {?} nativeEl
     * @return {?}
     */
    function (nativeEl) {
        /** @type {?} */
        var offsetParent = nativeEl.offsetParent || window.document;
        while (offsetParent && offsetParent !== window.document && this.isStaticPositioned(offsetParent)) {
            offsetParent = offsetParent.offsetParent;
        }
        return offsetParent || window.document;
    };
    // Check for overflow of the viewport and reflect the position if necessary.
    // Check for overflow of the viewport and reflect the position if necessary.
    /**
     * @protected
     * @param {?} placement
     * @param {?} hostElement
     * @param {?} targetElement
     * @return {?}
     */
    PopoverContentComponent.prototype.getEffectivePlacement = 
    // Check for overflow of the viewport and reflect the position if necessary.
    /**
     * @protected
     * @param {?} placement
     * @param {?} hostElement
     * @param {?} targetElement
     * @return {?}
     */
    function (placement, hostElement, targetElement) {
        /** @type {?} */
        var hostElBoundingRect = hostElement.getBoundingClientRect();
        /** @type {?} */
        var desiredPlacement = placement || PopoverPlacement.Top;
        // Determines if a popover overflows in a direction when in a specific position.
        /** @type {?} */
        var overflows = {
            positionTop: {
                top: hostElBoundingRect.top - targetElement.offsetHeight < 0,
                right: hostElBoundingRect.left + hostElBoundingRect.width / 2 + targetElement.offsetWidth / 2 > this.windowWidth,
                left: hostElBoundingRect.left + hostElBoundingRect.width / 2 - targetElement.offsetWidth / 2 < 0
            },
            positionTopRight: {
                top: hostElBoundingRect.top - targetElement.offsetHeight < 0,
                right: hostElBoundingRect.right + targetElement.offsetWidth > this.windowWidth
            },
            positionRight: {
                top: hostElBoundingRect.top + hostElBoundingRect.height / 2 - targetElement.offsetHeight / 2 < 0,
                right: hostElBoundingRect.right + targetElement.offsetWidth > this.windowWidth,
                bottom: hostElBoundingRect.top + hostElBoundingRect.height / 2 + targetElement.offsetHeight / 2 > this.windowHeight
            },
            positionBottomRight: {
                right: hostElBoundingRect.right + targetElement.offsetWidth > this.windowWidth,
                bottom: hostElBoundingRect.bottom + targetElement.offsetHeight > this.windowHeight
            },
            positionBottom: {
                right: hostElBoundingRect.left + hostElBoundingRect.width / 2 + targetElement.offsetWidth / 2 > this.windowWidth,
                bottom: hostElBoundingRect.bottom + targetElement.offsetHeight > this.windowHeight,
                left: hostElBoundingRect.left + hostElBoundingRect.width / 2 - targetElement.offsetWidth / 2 < 0
            },
            positionBottomLeft: {
                bottom: hostElBoundingRect.bottom + targetElement.offsetHeight > this.windowHeight,
                left: hostElBoundingRect.left - targetElement.offsetWidth < 0
            },
            positionLeft: {
                left: hostElBoundingRect.left < targetElement.offsetWidth,
                top: hostElBoundingRect.top + hostElBoundingRect.height / 2 - targetElement.offsetHeight / 2 < 0,
                bottom: hostElBoundingRect.top + hostElBoundingRect.height / 2 + targetElement.offsetHeight / 2 > this.windowHeight
            },
            positionTopLeft: {
                top: hostElBoundingRect.top - targetElement.offsetHeight < 0,
                left: hostElBoundingRect.left - targetElement.offsetWidth < 0
            }
        };
        if (desiredPlacement === PopoverPlacement.Top) {
            // If it overflows on the top AND left, go to bottom-right.
            if (overflows.positionTop.top && overflows.positionTop.left) {
                return PopoverPlacement.BottomRight;
                // If it overflows on the top AND right, go to bottom-left.
            }
            else if (overflows.positionTop.top && overflows.positionTop.right) {
                return PopoverPlacement.BottomLeft;
                // If it only overflows on the top, go to bottom.
            }
            else if (overflows.positionTop.top) {
                return PopoverPlacement.Bottom;
                // If it only overflows to the right, go to top-left.
            }
            else if (overflows.positionTop.right) {
                return PopoverPlacement.TopLeft;
                // If it only overflows to the left, go to top-right.
            }
            else if (overflows.positionTop.left) {
                return PopoverPlacement.TopRight;
            }
            else {
                return PopoverPlacement.Top;
            }
        }
        if (desiredPlacement === PopoverPlacement.TopRight) {
            // If it overflows on the top AND the right, try in the order: bottom, Bottom-left, left.
            if (overflows.positionTopRight.top && overflows.positionTopRight.right) {
                if (overflows.positionBottom.bottom) {
                    return PopoverPlacement.Left;
                }
                else if (overflows.positionBottom.right) {
                    return PopoverPlacement.BottomLeft;
                }
                else {
                    return PopoverPlacement.Bottom;
                }
                // If it only overflows on the top, try in the order: right, bottom-right.
            }
            else if (overflows.positionTopRight.top) {
                if (overflows.positionRight.top) {
                    return PopoverPlacement.BottomRight;
                }
                else {
                    return PopoverPlacement.Right;
                }
                // If it only overflows on the right, try in the order: top, top-left.
            }
            else if (overflows.positionTopRight.right) {
                if (overflows.positionTop.right) {
                    return PopoverPlacement.TopLeft;
                }
                else {
                    return PopoverPlacement.Top;
                }
            }
            else {
                return PopoverPlacement.TopRight;
            }
        }
        if (desiredPlacement === PopoverPlacement.Right) {
            // If it overflows on the right AND the top, try in the order: bottom-right, bottom, bottom-left.
            if (overflows.positionRight.right && overflows.positionRight.top) {
                if (overflows.positionBottomRight.right && overflows.positionBottom.right) {
                    return PopoverPlacement.BottomLeft;
                }
                else if (overflows.positionBottomRight.right) {
                    return PopoverPlacement.Bottom;
                }
                else {
                    return PopoverPlacement.BottomRight;
                }
                // If it overflows on the right AND the bottom, try in the order: top-right, top, top-left.
            }
            else if (overflows.positionRight.right && overflows.positionRight.bottom) {
                if (overflows.positionTopRight.right && overflows.positionTop.right) {
                    return PopoverPlacement.TopLeft;
                }
                else if (overflows.positionTopRight.right) {
                    return PopoverPlacement.Top;
                }
                else {
                    return PopoverPlacement.TopRight;
                }
                // If it only overflows on the right, try all top positions from right to left, then try all bottom positions right to left.
            }
            else if (overflows.positionRight.right) {
                if (overflows.positionTop.top) {
                    if (overflows.positionBottom.right) {
                        return PopoverPlacement.BottomLeft;
                    }
                    else if (overflows.positionBottomRight.right) {
                        return PopoverPlacement.Bottom;
                    }
                    else {
                        return PopoverPlacement.BottomRight;
                    }
                }
                else {
                    if (overflows.positionTop.right) {
                        return PopoverPlacement.TopLeft;
                    }
                    else if (overflows.positionTopRight.right) {
                        return PopoverPlacement.Top;
                    }
                    else {
                        return PopoverPlacement.TopRight;
                    }
                }
                // If it only over flows on the top, go bottom-right.
            }
            else if (overflows.positionRight.top) {
                return PopoverPlacement.BottomRight;
                // If it only overflows on the bottom, go top-right.
            }
            else if (overflows.positionRight.bottom) {
                return PopoverPlacement.TopRight;
            }
            else {
                return PopoverPlacement.Right;
            }
        }
        if (desiredPlacement === PopoverPlacement.BottomRight) {
            // If it overflows on the bottom AND the right, try in the order: top, top-left, left.
            if (overflows.positionBottomRight.bottom && overflows.positionBottomRight.right) {
                if (overflows.positionTop.top) {
                    return PopoverPlacement.Left;
                }
                else if (overflows.positionTop.right) {
                    return PopoverPlacement.TopLeft;
                }
                else {
                    return PopoverPlacement.Top;
                }
                // If it only overflows on the bottom, try in the order: right, top-right.
            }
            else if (overflows.positionBottomRight.bottom) {
                if (overflows.positionRight.bottom) {
                    return PopoverPlacement.TopRight;
                }
                else {
                    return PopoverPlacement.Right;
                }
                // If it only overflows on the right, try in the order: bottom, bottom-left.
            }
            else if (overflows.positionBottomRight.right) {
                if (overflows.positionBottom.right) {
                    return PopoverPlacement.BottomLeft;
                }
                else {
                    return PopoverPlacement.Bottom;
                }
            }
            else {
                return PopoverPlacement.BottomRight;
            }
        }
        if (desiredPlacement === PopoverPlacement.Bottom) {
            // If it overflows on the bottom AND left, go to top-right.
            if (overflows.positionBottom.bottom && overflows.positionBottom.left) {
                return PopoverPlacement.TopRight;
                // If it overflows on the bottom AND right, go to top-left.
            }
            else if (overflows.positionBottom.bottom && overflows.positionBottom.right) {
                return PopoverPlacement.TopLeft;
                // If it only overflows on the bottom, go to top.
            }
            else if (overflows.positionBottom.bottom) {
                return PopoverPlacement.Top;
                // If it only overflows to the right, go to bottom-left.
            }
            else if (overflows.positionBottom.right) {
                return PopoverPlacement.BottomLeft;
                // If it only overflows to the left, go to bottom-right.
            }
            else if (overflows.positionBottom.left) {
                return PopoverPlacement.BottomRight;
            }
            else {
                return PopoverPlacement.Bottom;
            }
        }
        if (desiredPlacement === PopoverPlacement.BottomLeft) {
            // If it overflows on the bottom AND the left, try in the order: top, top-right, right.
            if (overflows.positionBottomLeft.bottom && overflows.positionBottomLeft.left) {
                if (overflows.positionTop.top) {
                    return PopoverPlacement.Right;
                }
                else if (overflows.positionTop.left) {
                    return PopoverPlacement.TopRight;
                }
                else {
                    return PopoverPlacement.Top;
                }
                // If it only overflows on the bottom, try in the order: left, top-left.
            }
            else if (overflows.positionBottomLeft.bottom) {
                if (overflows.positionLeft.bottom) {
                    return PopoverPlacement.TopLeft;
                }
                else {
                    return PopoverPlacement.Left;
                }
                // If it only overflows on the left, try in the order: bottom, bottom-right.
            }
            else if (overflows.positionBottomLeft.left) {
                if (overflows.positionBottom.left) {
                    return PopoverPlacement.BottomRight;
                }
                else {
                    return PopoverPlacement.Bottom;
                }
            }
            else {
                return PopoverPlacement.BottomLeft;
            }
        }
        if (desiredPlacement === PopoverPlacement.Left) {
            // If it overflows on the left AND the top, try in the order: bottom-left, bottom, bottom-right.
            if (overflows.positionLeft.left && overflows.positionLeft.top) {
                if (overflows.positionBottomLeft.left && overflows.positionBottom.left) {
                    return PopoverPlacement.BottomRight;
                }
                else if (overflows.positionBottomRight.right) {
                    return PopoverPlacement.Bottom;
                }
                else {
                    return PopoverPlacement.BottomLeft;
                }
                // If it overflows on the left AND the bottom, try in the order: top-left, top, top-right.
            }
            else if (overflows.positionLeft.left && overflows.positionLeft.bottom) {
                if (overflows.positionTopLeft.left && overflows.positionTop.left) {
                    return PopoverPlacement.TopRight;
                }
                else if (overflows.positionTopLeft.left) {
                    return PopoverPlacement.Top;
                }
                else {
                    return PopoverPlacement.TopLeft;
                }
                // If it only overflows on the left, try all top positions from left to right, then try all bottom positions left to right.
            }
            else if (overflows.positionLeft.left) {
                if (overflows.positionTop.top) {
                    if (overflows.positionBottom.left) {
                        return PopoverPlacement.BottomRight;
                    }
                    else if (overflows.positionBottomLeft.left) {
                        return PopoverPlacement.Bottom;
                    }
                    else {
                        return PopoverPlacement.BottomLeft;
                    }
                }
                else {
                    if (overflows.positionTop.left) {
                        return PopoverPlacement.TopRight;
                    }
                    else if (overflows.positionTopLeft.left) {
                        return PopoverPlacement.Top;
                    }
                    else {
                        return PopoverPlacement.TopLeft;
                    }
                }
                // If it only over flows on the top, go bottom-left.
            }
            else if (overflows.positionLeft.top) {
                return PopoverPlacement.BottomLeft;
                // If it only overflows on the bottom, go top-left.
            }
            else if (overflows.positionLeft.bottom) {
                return PopoverPlacement.TopLeft;
            }
            else {
                return PopoverPlacement.Left;
            }
        }
        if (desiredPlacement === PopoverPlacement.TopLeft) {
            // If it overflows on the top AND the left, try in the order: bottom, Bottom-right, right.
            if (overflows.positionTopLeft.top && overflows.positionTopLeft.left) {
                if (overflows.positionBottom.bottom) {
                    return PopoverPlacement.Right;
                }
                else if (overflows.positionBottom.left) {
                    return PopoverPlacement.BottomRight;
                }
                else {
                    return PopoverPlacement.Bottom;
                }
                // If it only overflows on the top, try in the order: left, bottom-left.
            }
            else if (overflows.positionTopLeft.top) {
                if (overflows.positionLeft.top) {
                    return PopoverPlacement.BottomLeft;
                }
                else {
                    return PopoverPlacement.Left;
                }
                // If it only overflows on the left, try in the order: top, top-right.
            }
            else if (overflows.positionTopLeft.left) {
                if (overflows.positionTop.left) {
                    return PopoverPlacement.TopRight;
                }
                else {
                    return PopoverPlacement.Top;
                }
            }
            else {
                return PopoverPlacement.TopLeft;
            }
        }
        return desiredPlacement;
    };
    PopoverContentComponent.decorators = [
        { type: Component, args: [{
                    selector: 'popover-content',
                    template: "\n        <div #popoverDiv\n            class=\"bs-popover-{{ effectivePlacement }} popover-content popover {{ parentClass }}\"\n            [ngClass]=\"{\n                'sm': size === 'small',\n                'md-sm': size === 'medium-small',\n                'md': size === 'medium',\n                'lg': size === 'large',\n                'in': isIn\n            }\"\n            [style.top.px]=\"top\"\n            [style.left.px]=\"left\"\n            [style.transition]=\"(transitionEnabled ? '0.15s opacity' : '')\"\n            [style.opacity]=\"opacity\"\n            [style.display]=\"'block'\"\n            [attr.aria-hidden]=\"opacity === 0\"\n            role=\"popover\">\n                <div [hidden]=\"!closeOnMouseOutside\" class=\"virtual-area\"></div>\n                <div class=\"arrow\"></div>\n                <div class=\"popover-header\" [hidden]=\"!title\">{{ title }}</div>\n                <div class=\"popover-body\">\n                    <ng-content></ng-content>\n                    {{ content }}\n                </div>\n        </div>\n    "
                }] }
    ];
    /** @nocollapse */
    PopoverContentComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: Renderer2 }
    ]; };
    PopoverContentComponent.propDecorators = {
        content: [{ type: Input }],
        placement: [{ type: Input }],
        title: [{ type: Input }],
        parentClass: [{ type: Input }],
        animation: [{ type: Input }],
        closeOnClickOutside: [{ type: Input }],
        closeOnMouseOutside: [{ type: Input }],
        appendToBody: [{ type: Input }],
        size: [{ type: Input }],
        popoverDiv: [{ type: ViewChild, args: ['popoverDiv', { static: true },] }],
        onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
    };
    return PopoverContentComponent;
}());
export { PopoverContentComponent };
if (false) {
    /** @type {?} */
    PopoverContentComponent.prototype.content;
    /** @type {?} */
    PopoverContentComponent.prototype.placement;
    /** @type {?} */
    PopoverContentComponent.prototype.title;
    /** @type {?} */
    PopoverContentComponent.prototype.parentClass;
    /** @type {?} */
    PopoverContentComponent.prototype.animation;
    /** @type {?} */
    PopoverContentComponent.prototype.closeOnClickOutside;
    /** @type {?} */
    PopoverContentComponent.prototype.closeOnMouseOutside;
    /** @type {?} */
    PopoverContentComponent.prototype.appendToBody;
    /** @type {?} */
    PopoverContentComponent.prototype.size;
    /** @type {?} */
    PopoverContentComponent.prototype.popoverDiv;
    /** @type {?} */
    PopoverContentComponent.prototype.popover;
    /** @type {?} */
    PopoverContentComponent.prototype.onCloseFromOutside;
    /** @type {?} */
    PopoverContentComponent.prototype.top;
    /** @type {?} */
    PopoverContentComponent.prototype.left;
    /** @type {?} */
    PopoverContentComponent.prototype.isIn;
    /** @type {?} */
    PopoverContentComponent.prototype.effectivePlacement;
    /** @type {?} */
    PopoverContentComponent.prototype.opacity;
    /** @type {?} */
    PopoverContentComponent.prototype.transitionEnabled;
    /** @type {?} */
    PopoverContentComponent.prototype.windowWidth;
    /** @type {?} */
    PopoverContentComponent.prototype.windowHeight;
    /** @type {?} */
    PopoverContentComponent.prototype.listenClickFunc;
    /** @type {?} */
    PopoverContentComponent.prototype.listenMouseFunc;
    /** @type {?} */
    PopoverContentComponent.prototype.listenTouchFunc;
    /**
     * Closes dropdown if user clicks outside of this directive.
     * @type {?}
     */
    PopoverContentComponent.prototype.onDocumentMouseDown;
    /**
     * @type {?}
     * @protected
     */
    PopoverContentComponent.prototype.element;
    /**
     * @type {?}
     * @protected
     */
    PopoverContentComponent.prototype.cdr;
    /**
     * @type {?}
     * @protected
     */
    PopoverContentComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci1jb250ZW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1zbWFydC1wb3BvdmVyLyIsInNvdXJjZXMiOlsibGliL3BvcG92ZXItY29udGVudC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBS0EsT0FBTyxFQUVILGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBRUwsU0FBUyxFQUNULFNBQVMsRUFDVCxZQUFZLEVBQ2YsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdkQ7SUFrRkksNEVBQTRFO0lBQzVFLGNBQWM7SUFDZCw0RUFBNEU7SUFFNUUsaUNBQXNCLE9BQW1CLEVBQ25CLEdBQXNCLEVBQ3RCLFFBQW1CO1FBRnpDLGlCQUdDO1FBSHFCLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDbkIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQXREekIsY0FBUyxHQUFxQixnQkFBZ0IsQ0FBQyxHQUFHLENBQUM7UUFHbkQsY0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQix3QkFBbUIsR0FBRyxLQUFLLENBQUM7UUFDNUIsd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQzVCLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3JCLFNBQUksR0FBMkQsT0FBTyxDQUFDO1FBUWhGLHVCQUFrQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDeEMsUUFBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ2IsU0FBSSxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ2QsU0FBSSxHQUFHLEtBQUssQ0FBQztRQUViLFlBQU8sR0FBRyxDQUFDLENBQUM7UUFDWixzQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFFMUIsZ0JBQVcsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO1FBQ2hDLGlCQUFZLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQzs7Ozs7OztRQWFsQyx3QkFBbUI7Ozs7UUFBRyxVQUFDLEtBQVU7O2dCQUM5QixPQUFPLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhO1lBQzFDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxLQUFJLENBQUMsT0FBTyxFQUFFO2dCQUMzQixPQUFPO2FBQ1Y7WUFDRCxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDcEYsT0FBTzthQUNWO1lBQ0QsS0FBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1QyxDQUFDLEVBQUE7SUFTRCxDQUFDO0lBRUQsNEVBQTRFO0lBQzVFLHNCQUFzQjtJQUN0Qiw0RUFBNEU7Ozs7Ozs7SUFFckUsaURBQWU7Ozs7Ozs7SUFBdEI7UUFBQSxpQkFZQztRQVhHLElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO1lBQzFCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLFdBQVc7Ozs7WUFBRSxVQUFDLEtBQVUsSUFBSyxPQUFBLEtBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsRUFBL0IsQ0FBK0IsRUFBQyxDQUFDO1NBQ3pIO1FBQ0QsSUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsV0FBVzs7OztZQUFFLFVBQUMsS0FBVSxJQUFLLE9BQUEsS0FBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxFQUEvQixDQUErQixFQUFDLENBQUM7U0FDekg7UUFDRCw4Q0FBOEM7UUFDOUMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsWUFBWTs7OztRQUFFLFVBQUMsS0FBVSxJQUFLLE9BQUEsS0FBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxFQUEvQixDQUErQixFQUFDLENBQUM7UUFFdkgsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1osSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUM3QixDQUFDOzs7O0lBRU0sNkNBQVc7OztJQUFsQjtRQUNJLElBQUksSUFBSSxDQUFDLG1CQUFtQixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDbEQsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQzFCO1FBQ0QsSUFBSSxJQUFJLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUNsRCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDMUI7UUFDRCxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3hCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUMxQjtJQUNMLENBQUM7SUFFRCw0RUFBNEU7SUFDNUUsaUJBQWlCO0lBQ2pCLDRFQUE0RTs7Ozs7Ozs7SUFHckUsMENBQVE7Ozs7Ozs7O0lBRGYsVUFDZ0IsS0FBSztRQUNqQixJQUFJLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFDckMsSUFBSSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO0lBQzNDLENBQUM7Ozs7SUFFTSxnREFBYzs7O0lBQXJCO1FBQ0kseUJBQXlCO1FBQ3pCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTs7Z0JBQ1IsQ0FBQyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDekcsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ2pCLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztTQUN0QjtJQUNMLENBQUM7Ozs7SUFFTSxzQ0FBSTs7O0lBQVg7UUFDSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDN0MsT0FBTztTQUNWOztZQUVLLENBQUMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3pHLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztRQUNqQixJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDbkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQztRQUM5QixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztJQUNyQixDQUFDOzs7O0lBRU0sc0NBQUk7OztJQUFYO1FBQ0ksSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDeEIsQ0FBQzs7OztJQUVNLGlEQUFlOzs7SUFBdEI7UUFDSSxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQztRQUMvQixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztJQUNyQixDQUFDO0lBRUQsNEVBQTRFO0lBQzVFLG9CQUFvQjtJQUNwQiw0RUFBNEU7Ozs7Ozs7Ozs7OztJQUVsRSxrREFBZ0I7Ozs7Ozs7Ozs7OztJQUExQixVQUEyQixNQUFtQixFQUFFLFFBQXFCLEVBQUUsV0FBNkIsRUFBRSxZQUE2QjtRQUE3Qiw2QkFBQSxFQUFBLG9CQUE2Qjs7WUFDekgsZ0JBQWdCLEdBQUcsQ0FBQyxtQkFBQSxXQUFXLEVBQVUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7O1lBQ3ZELElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7O1lBQ3hCLElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFROztZQUN0QyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksSUFBSSxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDOztZQUMzRixhQUFhLEdBQUcsUUFBUSxDQUFDLFdBQVc7O1lBQ3BDLGNBQWMsR0FBRyxRQUFRLENBQUMsWUFBWTtRQUU1QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDOztZQUU5RSxVQUFVLEdBQVE7WUFDcEIsTUFBTTs7O1lBQUU7Z0JBQ0osT0FBTyxTQUFTLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLGFBQWEsR0FBRyxDQUFDLENBQUM7WUFDcEUsQ0FBQyxDQUFBO1lBQ0QsSUFBSTs7O1lBQUU7Z0JBQ0YsT0FBTyxTQUFTLENBQUMsSUFBSSxDQUFDO1lBQzFCLENBQUMsQ0FBQTtZQUNELEtBQUs7OztZQUFFO2dCQUNILE9BQU8sU0FBUyxDQUFDLElBQUksR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDO1lBQzVDLENBQUMsQ0FBQTtZQUNELGdCQUFnQjs7O1lBQUU7Z0JBQ2QsT0FBTyxTQUFTLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ2hELENBQUMsQ0FBQTtZQUNELGVBQWU7OztZQUFFO2dCQUNiLE9BQU8sU0FBUyxDQUFDLElBQUksR0FBRyxhQUFhLEdBQUksU0FBUyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDakUsQ0FBQyxDQUFBO1NBQ0o7O1lBRUssV0FBVyxHQUFRO1lBQ3JCLE1BQU07OztZQUFFO2dCQUNKLE9BQU8sU0FBUyxDQUFDLEdBQUcsR0FBRyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxjQUFjLEdBQUcsQ0FBQyxDQUFDO1lBQ3JFLENBQUMsQ0FBQTtZQUNELEdBQUc7OztZQUFFO2dCQUNELE9BQU8sU0FBUyxDQUFDLEdBQUcsQ0FBQztZQUN6QixDQUFDLENBQUE7WUFDRCxNQUFNOzs7WUFBRTtnQkFDSixPQUFPLFNBQVMsQ0FBQyxHQUFHLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQztZQUM1QyxDQUFDLENBQUE7U0FDSjs7WUFFRyxXQUEwQztRQUM5QyxRQUFRLElBQUksRUFBRTtZQUNWLEtBQUssZ0JBQWdCLENBQUMsS0FBSztnQkFDdkIsV0FBVyxHQUFHO29CQUNWLEdBQUcsRUFBRSxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQ3hCLElBQUksRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUU7aUJBQzNCLENBQUM7Z0JBQ0YsTUFBTTtZQUVWLEtBQUssZ0JBQWdCLENBQUMsSUFBSTtnQkFDdEIsV0FBVyxHQUFHO29CQUNWLEdBQUcsRUFBRSxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQ3hCLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSSxHQUFHLGFBQWE7aUJBQ3ZDLENBQUM7Z0JBQ0YsTUFBTTtZQUVWLEtBQUssZ0JBQWdCLENBQUMsTUFBTTtnQkFDeEIsV0FBVyxHQUFHO29CQUNWLEdBQUcsRUFBRSxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQ3hCLElBQUksRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUU7aUJBQzNCLENBQUM7Z0JBQ0YsTUFBTTtZQUNWLEtBQUssZ0JBQWdCLENBQUMsT0FBTztnQkFDekIsV0FBVyxHQUFHO29CQUNWLEdBQUcsRUFBRSxTQUFTLENBQUMsR0FBRyxHQUFHLGNBQWM7b0JBQ25DLElBQUksRUFBRSxVQUFVLENBQUMsaUJBQWlCLENBQUMsRUFBRTtpQkFDeEMsQ0FBQztnQkFDRixNQUFNO1lBQ1YsS0FBSyxnQkFBZ0IsQ0FBQyxRQUFRO2dCQUMxQixXQUFXLEdBQUc7b0JBQ1YsR0FBRyxFQUFFLFNBQVMsQ0FBQyxHQUFHLEdBQUcsY0FBYztvQkFDbkMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFO2lCQUN6QyxDQUFDO2dCQUNGLE1BQU07WUFDVixLQUFLLGdCQUFnQixDQUFDLFVBQVU7Z0JBQzVCLFdBQVcsR0FBRztvQkFDVixHQUFHLEVBQUUsV0FBVyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxFQUFFO29CQUMzQyxJQUFJLEVBQUUsVUFBVSxDQUFDLGlCQUFpQixDQUFDLEVBQUU7aUJBQ3hDLENBQUM7Z0JBQ0YsTUFBTTtZQUNWLEtBQUssZ0JBQWdCLENBQUMsV0FBVztnQkFDN0IsV0FBVyxHQUFHO29CQUNWLEdBQUcsRUFBRSxXQUFXLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLEVBQUU7b0JBQzNDLElBQUksRUFBRSxVQUFVLENBQUMsa0JBQWtCLENBQUMsRUFBRTtpQkFDekMsQ0FBQztnQkFDRixNQUFNO1lBRVY7Z0JBQ0ksV0FBVyxHQUFHO29CQUNWLEdBQUcsRUFBRSxTQUFTLENBQUMsR0FBRyxHQUFHLGNBQWM7b0JBQ25DLElBQUksRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUU7aUJBQzNCLENBQUM7Z0JBQ0YsTUFBTTtTQUNiO1FBRUQsT0FBTyxXQUFXLENBQUM7SUFDdkIsQ0FBQzs7Ozs7O0lBRVMsMENBQVE7Ozs7O0lBQWxCLFVBQW1CLFFBQXFCOztZQUNoQyxlQUFlLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUU7O1lBQ25DLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQzs7WUFDN0IsY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDO1FBQ3BELElBQUksY0FBYyxLQUFLLE1BQU0sQ0FBQyxRQUFRLEVBQUU7WUFDcEMsZUFBZSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDOUMsZUFBZSxDQUFDLEdBQUcsSUFBSSxjQUFjLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQyxTQUFTLENBQUM7WUFDM0UsZUFBZSxDQUFDLElBQUksSUFBSSxjQUFjLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQyxVQUFVLENBQUM7U0FDakY7O1lBRUssa0JBQWtCLEdBQUcsUUFBUSxDQUFDLHFCQUFxQixFQUFFO1FBQzNELE9BQU87WUFDSCxLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxJQUFJLFFBQVEsQ0FBQyxXQUFXO1lBQ3ZELE1BQU0sRUFBRSxrQkFBa0IsQ0FBQyxNQUFNLElBQUksUUFBUSxDQUFDLFlBQVk7WUFDMUQsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHLEdBQUcsZUFBZSxDQUFDLEdBQUc7WUFDcEMsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJLEdBQUcsZUFBZSxDQUFDLElBQUk7U0FDMUMsQ0FBQztJQUNOLENBQUM7Ozs7OztJQUVTLHdDQUFNOzs7OztJQUFoQixVQUFpQixRQUFhOztZQUNwQixrQkFBa0IsR0FBRyxRQUFRLENBQUMscUJBQXFCLEVBQUU7UUFDM0QsT0FBTztZQUNILEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLFdBQVc7WUFDdkQsTUFBTSxFQUFFLGtCQUFrQixDQUFDLE1BQU0sSUFBSSxRQUFRLENBQUMsWUFBWTtZQUMxRCxHQUFHLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLFdBQVcsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUM7WUFDL0YsSUFBSSxFQUFFLGtCQUFrQixDQUFDLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxXQUFXLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDO1NBQ3JHLENBQUM7SUFDTixDQUFDOzs7Ozs7O0lBRVMsMENBQVE7Ozs7OztJQUFsQixVQUFtQixRQUFxQixFQUFFLE9BQWU7UUFDckQsSUFBSSxDQUFDLG1CQUFBLFFBQVEsRUFBTyxDQUFDLENBQUMsWUFBWSxFQUFFLEVBQUUsS0FBSztZQUN2QyxPQUFPLENBQUMsbUJBQUEsUUFBUSxFQUFPLENBQUMsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDbEQ7UUFFRCxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRTtZQUN6QixPQUFPLENBQUMsbUJBQUEsTUFBTSxDQUFDLGdCQUFnQixFQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUM5RDtRQUVELG1DQUFtQztRQUNuQyxPQUFPLENBQUMsbUJBQUEsUUFBUSxDQUFDLEtBQUssRUFBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDNUMsQ0FBQzs7Ozs7O0lBRVMsb0RBQWtCOzs7OztJQUE1QixVQUE2QixRQUFxQjtRQUM5QyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLElBQUksUUFBUSxDQUFFLEtBQUssUUFBUSxDQUFDO0lBQzNFLENBQUM7Ozs7OztJQUVTLGdEQUFjOzs7OztJQUF4QixVQUF5QixRQUFxQjs7WUFDdEMsWUFBWSxHQUFRLFFBQVEsQ0FBQyxZQUFZLElBQUksTUFBTSxDQUFDLFFBQVE7UUFDaEUsT0FBTyxZQUFZLElBQUksWUFBWSxLQUFLLE1BQU0sQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQzlGLFlBQVksR0FBRyxZQUFZLENBQUMsWUFBWSxDQUFDO1NBQzVDO1FBQ0QsT0FBTyxZQUFZLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQztJQUMzQyxDQUFDO0lBRUQsNEVBQTRFOzs7Ozs7Ozs7SUFDbEUsdURBQXFCOzs7Ozs7Ozs7SUFBL0IsVUFBZ0MsU0FBaUIsRUFBRSxXQUF3QixFQUFFLGFBQTBCOztZQUM3RixrQkFBa0IsR0FBRyxXQUFXLENBQUMscUJBQXFCLEVBQUU7O1lBRXhELGdCQUFnQixHQUFHLFNBQVMsSUFBSSxnQkFBZ0IsQ0FBQyxHQUFHOzs7WUFHcEQsU0FBUyxHQUFHO1lBQ2QsV0FBVyxFQUFFO2dCQUNULEdBQUcsRUFBRSxrQkFBa0IsQ0FBQyxHQUFHLEdBQUcsYUFBYSxDQUFDLFlBQVksR0FBRyxDQUFDO2dCQUM1RCxLQUFLLEVBQUUsa0JBQWtCLENBQUMsSUFBSSxHQUFHLGtCQUFrQixDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDLFdBQVcsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVc7Z0JBQ2hILElBQUksRUFBRSxrQkFBa0IsQ0FBQyxJQUFJLEdBQUcsa0JBQWtCLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxhQUFhLENBQUMsV0FBVyxHQUFHLENBQUMsR0FBRyxDQUFDO2FBQ25HO1lBQ0QsZ0JBQWdCLEVBQUU7Z0JBQ2QsR0FBRyxFQUFFLGtCQUFrQixDQUFDLEdBQUcsR0FBRyxhQUFhLENBQUMsWUFBWSxHQUFHLENBQUM7Z0JBQzVELEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxLQUFLLEdBQUcsYUFBYSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVzthQUNqRjtZQUNELGFBQWEsRUFBRTtnQkFDWCxHQUFHLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxHQUFHLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDLFlBQVksR0FBRyxDQUFDLEdBQUcsQ0FBQztnQkFDaEcsS0FBSyxFQUFFLGtCQUFrQixDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXO2dCQUM5RSxNQUFNLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxHQUFHLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDLFlBQVksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVk7YUFDdEg7WUFDRCxtQkFBbUIsRUFBRTtnQkFDakIsS0FBSyxFQUFFLGtCQUFrQixDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXO2dCQUM5RSxNQUFNLEVBQUUsa0JBQWtCLENBQUMsTUFBTSxHQUFHLGFBQWEsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVk7YUFDckY7WUFDRCxjQUFjLEVBQUU7Z0JBQ1osS0FBSyxFQUFFLGtCQUFrQixDQUFDLElBQUksR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXO2dCQUNoSCxNQUFNLEVBQUUsa0JBQWtCLENBQUMsTUFBTSxHQUFHLGFBQWEsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVk7Z0JBQ2xGLElBQUksRUFBRSxrQkFBa0IsQ0FBQyxJQUFJLEdBQUcsa0JBQWtCLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxhQUFhLENBQUMsV0FBVyxHQUFHLENBQUMsR0FBRyxDQUFDO2FBQ25HO1lBQ0Qsa0JBQWtCLEVBQUU7Z0JBQ2hCLE1BQU0sRUFBRSxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsYUFBYSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWTtnQkFDbEYsSUFBSSxFQUFFLGtCQUFrQixDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsV0FBVyxHQUFHLENBQUM7YUFDaEU7WUFDRCxZQUFZLEVBQUU7Z0JBQ1YsSUFBSSxFQUFFLGtCQUFrQixDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsV0FBVztnQkFDekQsR0FBRyxFQUFFLGtCQUFrQixDQUFDLEdBQUcsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxHQUFHLENBQUM7Z0JBQ2hHLE1BQU0sRUFBRSxrQkFBa0IsQ0FBQyxHQUFHLEdBQUcsa0JBQWtCLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxhQUFhLENBQUMsWUFBWSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWTthQUN0SDtZQUNELGVBQWUsRUFBRTtnQkFDYixHQUFHLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxHQUFHLGFBQWEsQ0FBQyxZQUFZLEdBQUcsQ0FBQztnQkFDNUQsSUFBSSxFQUFFLGtCQUFrQixDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsV0FBVyxHQUFHLENBQUM7YUFDaEU7U0FDSjtRQUVELElBQUksZ0JBQWdCLEtBQUssZ0JBQWdCLENBQUMsR0FBRyxFQUFFO1lBQzNDLDJEQUEyRDtZQUMzRCxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFO2dCQUN6RCxPQUFPLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztnQkFFeEMsMkRBQTJEO2FBQzFEO2lCQUFNLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxHQUFHLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUU7Z0JBQ2pFLE9BQU8sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO2dCQUV2QyxpREFBaUQ7YUFDaEQ7aUJBQU0sSUFBSSxTQUFTLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRTtnQkFDbEMsT0FBTyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7Z0JBRW5DLHFEQUFxRDthQUNwRDtpQkFBTSxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFO2dCQUNwQyxPQUFPLGdCQUFnQixDQUFDLE9BQU8sQ0FBQztnQkFFcEMscURBQXFEO2FBQ3BEO2lCQUFNLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUU7Z0JBQ25DLE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO2FBRXBDO2lCQUFNO2dCQUNILE9BQU8sZ0JBQWdCLENBQUMsR0FBRyxDQUFDO2FBQy9CO1NBQ0o7UUFFRCxJQUFJLGdCQUFnQixLQUFLLGdCQUFnQixDQUFDLFFBQVEsRUFBRTtZQUNoRCx5RkFBeUY7WUFDekYsSUFBSSxTQUFTLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUU7Z0JBQ3BFLElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUU7b0JBQ2pDLE9BQU8sZ0JBQWdCLENBQUMsSUFBSSxDQUFDO2lCQUNoQztxQkFBTSxJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFO29CQUN2QyxPQUFPLGdCQUFnQixDQUFDLFVBQVUsQ0FBQztpQkFDdEM7cUJBQU07b0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7aUJBQ2xDO2dCQUVMLDBFQUEwRTthQUN6RTtpQkFBTSxJQUFJLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQ3ZDLElBQUksU0FBUyxDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUU7b0JBQzdCLE9BQU8sZ0JBQWdCLENBQUMsV0FBVyxDQUFDO2lCQUN2QztxQkFBTTtvQkFDSCxPQUFPLGdCQUFnQixDQUFDLEtBQUssQ0FBQztpQkFDakM7Z0JBRUwsc0VBQXNFO2FBQ3JFO2lCQUFNLElBQUksU0FBUyxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRTtnQkFDekMsSUFBSSxTQUFTLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRTtvQkFDN0IsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7aUJBQ25DO3FCQUFNO29CQUNILE9BQU8sZ0JBQWdCLENBQUMsR0FBRyxDQUFDO2lCQUMvQjthQUVKO2lCQUFNO2dCQUNILE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO2FBQ3BDO1NBQ0o7UUFFRCxJQUFJLGdCQUFnQixLQUFLLGdCQUFnQixDQUFDLEtBQUssRUFBRTtZQUM3QyxpR0FBaUc7WUFDakcsSUFBSSxTQUFTLENBQUMsYUFBYSxDQUFDLEtBQUssSUFBSSxTQUFTLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRTtnQkFDOUQsSUFBSSxTQUFTLENBQUMsbUJBQW1CLENBQUMsS0FBSyxJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFO29CQUN2RSxPQUFPLGdCQUFnQixDQUFDLFVBQVUsQ0FBQztpQkFDdEM7cUJBQU0sSUFBSSxTQUFTLENBQUMsbUJBQW1CLENBQUMsS0FBSyxFQUFFO29CQUM1QyxPQUFPLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztpQkFDbEM7cUJBQU07b0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7aUJBQ3ZDO2dCQUVMLDJGQUEyRjthQUMxRjtpQkFBTSxJQUFJLFNBQVMsQ0FBQyxhQUFhLENBQUMsS0FBSyxJQUFJLFNBQVMsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFO2dCQUN4RSxJQUFJLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUU7b0JBQ2pFLE9BQU8sZ0JBQWdCLENBQUMsT0FBTyxDQUFDO2lCQUNuQztxQkFBTSxJQUFJLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUU7b0JBQ3pDLE9BQU8sZ0JBQWdCLENBQUMsR0FBRyxDQUFDO2lCQUMvQjtxQkFBTTtvQkFDSCxPQUFPLGdCQUFnQixDQUFDLFFBQVEsQ0FBQztpQkFDcEM7Z0JBRUwsNEhBQTRIO2FBQzNIO2lCQUFNLElBQUksU0FBUyxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUU7Z0JBQ3RDLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUU7b0JBQzNCLElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUU7d0JBQ2hDLE9BQU8sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO3FCQUN0Qzt5QkFBTSxJQUFJLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUU7d0JBQzVDLE9BQU8sZ0JBQWdCLENBQUMsTUFBTSxDQUFDO3FCQUNsQzt5QkFBTTt3QkFDSCxPQUFPLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztxQkFDdkM7aUJBQ0o7cUJBQU07b0JBQ0gsSUFBSSxTQUFTLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRTt3QkFDN0IsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7cUJBQ25DO3lCQUFNLElBQUksU0FBUyxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRTt3QkFDekMsT0FBTyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUM7cUJBQy9CO3lCQUFNO3dCQUNILE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO3FCQUNwQztpQkFDSjtnQkFFTCxxREFBcUQ7YUFDcEQ7aUJBQU0sSUFBSSxTQUFTLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRTtnQkFDcEMsT0FBTyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7Z0JBRXhDLG9EQUFvRDthQUNuRDtpQkFBTSxJQUFJLFNBQVMsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFO2dCQUN2QyxPQUFPLGdCQUFnQixDQUFDLFFBQVEsQ0FBQzthQUVwQztpQkFBTTtnQkFDSCxPQUFPLGdCQUFnQixDQUFDLEtBQUssQ0FBQzthQUNqQztTQUNKO1FBRUQsSUFBSSxnQkFBZ0IsS0FBSyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUU7WUFDbkQsc0ZBQXNGO1lBQ3RGLElBQUksU0FBUyxDQUFDLG1CQUFtQixDQUFDLE1BQU0sSUFBSSxTQUFTLENBQUMsbUJBQW1CLENBQUMsS0FBSyxFQUFFO2dCQUM3RSxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFO29CQUMzQixPQUFPLGdCQUFnQixDQUFDLElBQUksQ0FBQztpQkFDaEM7cUJBQU0sSUFBSSxTQUFTLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRTtvQkFDcEMsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7aUJBQ25DO3FCQUFNO29CQUNILE9BQU8sZ0JBQWdCLENBQUMsR0FBRyxDQUFDO2lCQUMvQjtnQkFFTCwwRUFBMEU7YUFDekU7aUJBQU0sSUFBSSxTQUFTLENBQUMsbUJBQW1CLENBQUMsTUFBTSxFQUFFO2dCQUM3QyxJQUFJLFNBQVMsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFO29CQUNoQyxPQUFPLGdCQUFnQixDQUFDLFFBQVEsQ0FBQztpQkFDcEM7cUJBQU07b0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUM7aUJBQ2pDO2dCQUVMLDRFQUE0RTthQUMzRTtpQkFBTSxJQUFJLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUU7Z0JBQzVDLElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUU7b0JBQ2hDLE9BQU8sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO2lCQUN0QztxQkFBTTtvQkFDSCxPQUFPLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztpQkFDbEM7YUFFSjtpQkFBTTtnQkFDSCxPQUFPLGdCQUFnQixDQUFDLFdBQVcsQ0FBQzthQUN2QztTQUNKO1FBRUQsSUFBSSxnQkFBZ0IsS0FBSyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUU7WUFDOUMsMkRBQTJEO1lBQzNELElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxNQUFNLElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUU7Z0JBQ2xFLE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO2dCQUVyQywyREFBMkQ7YUFDMUQ7aUJBQU0sSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLE1BQU0sSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRTtnQkFDMUUsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7Z0JBRXBDLGlEQUFpRDthQUNoRDtpQkFBTSxJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFO2dCQUN4QyxPQUFPLGdCQUFnQixDQUFDLEdBQUcsQ0FBQztnQkFFaEMsd0RBQXdEO2FBQ3ZEO2lCQUFNLElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUU7Z0JBQ3ZDLE9BQU8sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO2dCQUV2Qyx3REFBd0Q7YUFDdkQ7aUJBQU0sSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRTtnQkFDdEMsT0FBTyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7YUFFdkM7aUJBQU07Z0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7YUFDbEM7U0FDSjtRQUVELElBQUksZ0JBQWdCLEtBQUssZ0JBQWdCLENBQUMsVUFBVSxFQUFFO1lBQ2xELHVGQUF1RjtZQUN2RixJQUFJLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLElBQUksU0FBUyxDQUFDLGtCQUFrQixDQUFDLElBQUksRUFBRTtnQkFDMUUsSUFBSSxTQUFTLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRTtvQkFDM0IsT0FBTyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUM7aUJBQ2pDO3FCQUFNLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUU7b0JBQ25DLE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO2lCQUNwQztxQkFBTTtvQkFDSCxPQUFPLGdCQUFnQixDQUFDLEdBQUcsQ0FBQztpQkFDL0I7Z0JBRUwsd0VBQXdFO2FBQ3ZFO2lCQUFNLElBQUksU0FBUyxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRTtnQkFDNUMsSUFBSSxTQUFTLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRTtvQkFDL0IsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7aUJBQ25DO3FCQUFNO29CQUNILE9BQU8sZ0JBQWdCLENBQUMsSUFBSSxDQUFDO2lCQUNoQztnQkFFTCw0RUFBNEU7YUFDM0U7aUJBQU0sSUFBSSxTQUFTLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFO2dCQUMxQyxJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFO29CQUMvQixPQUFPLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztpQkFDdkM7cUJBQU07b0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7aUJBQ2xDO2FBRUo7aUJBQU07Z0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7YUFDdEM7U0FDSjtRQUVELElBQUksZ0JBQWdCLEtBQUssZ0JBQWdCLENBQUMsSUFBSSxFQUFFO1lBQzVDLGdHQUFnRztZQUNoRyxJQUFJLFNBQVMsQ0FBQyxZQUFZLENBQUMsSUFBSSxJQUFJLFNBQVMsQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFO2dCQUMzRCxJQUFJLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUU7b0JBQ3BFLE9BQU8sZ0JBQWdCLENBQUMsV0FBVyxDQUFDO2lCQUN2QztxQkFBTSxJQUFJLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUU7b0JBQzVDLE9BQU8sZ0JBQWdCLENBQUMsTUFBTSxDQUFDO2lCQUNsQztxQkFBTTtvQkFDSCxPQUFPLGdCQUFnQixDQUFDLFVBQVUsQ0FBQztpQkFDdEM7Z0JBRUwsMEZBQTBGO2FBQ3pGO2lCQUFNLElBQUksU0FBUyxDQUFDLFlBQVksQ0FBQyxJQUFJLElBQUksU0FBUyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUU7Z0JBQ3JFLElBQUksU0FBUyxDQUFDLGVBQWUsQ0FBQyxJQUFJLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUU7b0JBQzlELE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO2lCQUNwQztxQkFBTSxJQUFJLFNBQVMsQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFO29CQUN2QyxPQUFPLGdCQUFnQixDQUFDLEdBQUcsQ0FBQztpQkFDL0I7cUJBQU07b0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7aUJBQ25DO2dCQUVMLDJIQUEySDthQUMxSDtpQkFBTSxJQUFJLFNBQVMsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFO2dCQUNwQyxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFO29CQUMzQixJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFO3dCQUMvQixPQUFPLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztxQkFDdkM7eUJBQU0sSUFBSSxTQUFTLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFO3dCQUMxQyxPQUFPLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztxQkFDbEM7eUJBQU07d0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7cUJBQ3RDO2lCQUNKO3FCQUFNO29CQUNILElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUU7d0JBQzVCLE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO3FCQUNwQzt5QkFBTSxJQUFJLFNBQVMsQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFO3dCQUN2QyxPQUFPLGdCQUFnQixDQUFDLEdBQUcsQ0FBQztxQkFDL0I7eUJBQU07d0JBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7cUJBQ25DO2lCQUNKO2dCQUVMLG9EQUFvRDthQUNuRDtpQkFBTSxJQUFJLFNBQVMsQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFO2dCQUNuQyxPQUFPLGdCQUFnQixDQUFDLFVBQVUsQ0FBQztnQkFFdkMsbURBQW1EO2FBQ2xEO2lCQUFNLElBQUksU0FBUyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUU7Z0JBQ3RDLE9BQU8sZ0JBQWdCLENBQUMsT0FBTyxDQUFDO2FBRW5DO2lCQUFNO2dCQUNILE9BQU8sZ0JBQWdCLENBQUMsSUFBSSxDQUFDO2FBQ2hDO1NBQ0o7UUFFRCxJQUFJLGdCQUFnQixLQUFLLGdCQUFnQixDQUFDLE9BQU8sRUFBRTtZQUMvQywwRkFBMEY7WUFDMUYsSUFBSSxTQUFTLENBQUMsZUFBZSxDQUFDLEdBQUcsSUFBSSxTQUFTLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRTtnQkFDakUsSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRTtvQkFDakMsT0FBTyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUM7aUJBQ2pDO3FCQUFNLElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUU7b0JBQ3RDLE9BQU8sZ0JBQWdCLENBQUMsV0FBVyxDQUFDO2lCQUN2QztxQkFBTTtvQkFDSCxPQUFPLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztpQkFDbEM7Z0JBRUwsd0VBQXdFO2FBQ3ZFO2lCQUFNLElBQUksU0FBUyxDQUFDLGVBQWUsQ0FBQyxHQUFHLEVBQUU7Z0JBQ3RDLElBQUksU0FBUyxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUU7b0JBQzVCLE9BQU8sZ0JBQWdCLENBQUMsVUFBVSxDQUFDO2lCQUN0QztxQkFBTTtvQkFDSCxPQUFPLGdCQUFnQixDQUFDLElBQUksQ0FBQztpQkFDaEM7Z0JBRUwsc0VBQXNFO2FBQ3JFO2lCQUFNLElBQUksU0FBUyxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUU7Z0JBQ3ZDLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUU7b0JBQzVCLE9BQU8sZ0JBQWdCLENBQUMsUUFBUSxDQUFDO2lCQUNwQztxQkFBTTtvQkFDSCxPQUFPLGdCQUFnQixDQUFDLEdBQUcsQ0FBQztpQkFDL0I7YUFFSjtpQkFBTTtnQkFDSCxPQUFPLGdCQUFnQixDQUFDLE9BQU8sQ0FBQzthQUNuQztTQUNKO1FBRUQsT0FBTyxnQkFBZ0IsQ0FBQztJQUM1QixDQUFDOztnQkFucEJKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsaUJBQWlCO29CQUMzQixRQUFRLEVBQUUsMGpDQXlCVDtpQkFDSjs7OztnQkF2Q0csVUFBVTtnQkFGVixpQkFBaUI7Z0JBTWpCLFNBQVM7OzswQkF3Q1IsS0FBSzs0QkFDTCxLQUFLO3dCQUNMLEtBQUs7OEJBQ0wsS0FBSzs0QkFDTCxLQUFLO3NDQUNMLEtBQUs7c0NBQ0wsS0FBSzsrQkFDTCxLQUFLO3VCQUNMLEtBQUs7NkJBS0wsU0FBUyxTQUFDLFlBQVksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MkJBK0V4QyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOztJQXVoQjdDLDhCQUFDO0NBQUEsQUFwcEJELElBb3BCQztTQXZuQlksdUJBQXVCOzs7SUFJaEMsMENBQWdDOztJQUNoQyw0Q0FBbUU7O0lBQ25FLHdDQUE4Qjs7SUFDOUIsOENBQW9DOztJQUNwQyw0Q0FBaUM7O0lBQ2pDLHNEQUE0Qzs7SUFDNUMsc0RBQTRDOztJQUM1QywrQ0FBcUM7O0lBQ3JDLHVDQUF1Rjs7SUFLdkYsNkNBQXlFOztJQUV6RSwwQ0FBaUM7O0lBQ2pDLHFEQUErQzs7SUFDL0Msc0NBQW9COztJQUNwQix1Q0FBcUI7O0lBQ3JCLHVDQUFvQjs7SUFDcEIscURBQWtDOztJQUNsQywwQ0FBbUI7O0lBQ25CLG9EQUFpQzs7SUFFakMsOENBQXVDOztJQUN2QywrQ0FBeUM7O0lBRXpDLGtEQUE0Qjs7SUFDNUIsa0RBQTRCOztJQUM1QixrREFBNEI7Ozs7O0lBUzVCLHNEQVNDOzs7OztJQU1XLDBDQUE2Qjs7Ozs7SUFDN0Isc0NBQWdDOzs7OztJQUNoQywyQ0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRoaXMgaXMgYSBjb250aW51YXRpb24gb2Ygbmd4LXBvcG92ZXJcbiAqIEBSZWZlcmVuY2Uge2dpdGh1Yn0gaHR0cHM6Ly9naXRodWIuY29tL3BsZWVyb2NrL25neC1wb3BvdmVyXG4gKi9cblxuaW1wb3J0IHtcbiAgICBBZnRlclZpZXdJbml0LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCxcbiAgICBPbkRlc3Ryb3ksXG4gICAgUmVuZGVyZXIyLFxuICAgIFZpZXdDaGlsZCxcbiAgICBIb3N0TGlzdGVuZXJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQb3BvdmVyRGlyZWN0aXZlIH0gZnJvbSAnLi9wb3BvdmVyLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBQb3BvdmVyUGxhY2VtZW50IH0gZnJvbSAnLi9wb3BvdmVyLnBsYWNlbWVudCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAncG9wb3Zlci1jb250ZW50JyxcbiAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8ZGl2ICNwb3BvdmVyRGl2XG4gICAgICAgICAgICBjbGFzcz1cImJzLXBvcG92ZXIte3sgZWZmZWN0aXZlUGxhY2VtZW50IH19IHBvcG92ZXItY29udGVudCBwb3BvdmVyIHt7IHBhcmVudENsYXNzIH19XCJcbiAgICAgICAgICAgIFtuZ0NsYXNzXT1cIntcbiAgICAgICAgICAgICAgICAnc20nOiBzaXplID09PSAnc21hbGwnLFxuICAgICAgICAgICAgICAgICdtZC1zbSc6IHNpemUgPT09ICdtZWRpdW0tc21hbGwnLFxuICAgICAgICAgICAgICAgICdtZCc6IHNpemUgPT09ICdtZWRpdW0nLFxuICAgICAgICAgICAgICAgICdsZyc6IHNpemUgPT09ICdsYXJnZScsXG4gICAgICAgICAgICAgICAgJ2luJzogaXNJblxuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgICBbc3R5bGUudG9wLnB4XT1cInRvcFwiXG4gICAgICAgICAgICBbc3R5bGUubGVmdC5weF09XCJsZWZ0XCJcbiAgICAgICAgICAgIFtzdHlsZS50cmFuc2l0aW9uXT1cIih0cmFuc2l0aW9uRW5hYmxlZCA/ICcwLjE1cyBvcGFjaXR5JyA6ICcnKVwiXG4gICAgICAgICAgICBbc3R5bGUub3BhY2l0eV09XCJvcGFjaXR5XCJcbiAgICAgICAgICAgIFtzdHlsZS5kaXNwbGF5XT1cIidibG9jaydcIlxuICAgICAgICAgICAgW2F0dHIuYXJpYS1oaWRkZW5dPVwib3BhY2l0eSA9PT0gMFwiXG4gICAgICAgICAgICByb2xlPVwicG9wb3ZlclwiPlxuICAgICAgICAgICAgICAgIDxkaXYgW2hpZGRlbl09XCIhY2xvc2VPbk1vdXNlT3V0c2lkZVwiIGNsYXNzPVwidmlydHVhbC1hcmVhXCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImFycm93XCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInBvcG92ZXItaGVhZGVyXCIgW2hpZGRlbl09XCIhdGl0bGVcIj57eyB0aXRsZSB9fTwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwb3BvdmVyLWJvZHlcIj5cbiAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgICAgICAgICAgICAgICB7eyBjb250ZW50IH19XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIGBcbn0pXG5leHBvcnQgY2xhc3MgUG9wb3ZlckNvbnRlbnRDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBJbnB1dHMgLyBPdXRwdXRzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIEBJbnB1dCgpIHB1YmxpYyBjb250ZW50OiBzdHJpbmc7XG4gICAgQElucHV0KCkgcHVibGljIHBsYWNlbWVudDogUG9wb3ZlclBsYWNlbWVudCA9IFBvcG92ZXJQbGFjZW1lbnQuVG9wO1xuICAgIEBJbnB1dCgpIHB1YmxpYyB0aXRsZTogc3RyaW5nO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBwYXJlbnRDbGFzczogc3RyaW5nO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBhbmltYXRpb24gPSB0cnVlO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBjbG9zZU9uQ2xpY2tPdXRzaWRlID0gZmFsc2U7XG4gICAgQElucHV0KCkgcHVibGljIGNsb3NlT25Nb3VzZU91dHNpZGUgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgYXBwZW5kVG9Cb2R5ID0gZmFsc2U7XG4gICAgQElucHV0KCkgcHVibGljIHNpemU6ICdzbWFsbCcgfCAnbWVkaXVtLXNtYWxsJyB8ICdtZWRpdW0nIHwgJ2xhcmdlJyB8ICdhdXRvJyA9ICdzbWFsbCc7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gUHJvcGVydGllc1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBAVmlld0NoaWxkKCdwb3BvdmVyRGl2JywgeyBzdGF0aWM6IHRydWUgfSkgcHVibGljIHBvcG92ZXJEaXY6IEVsZW1lbnRSZWY7XG5cbiAgICBwdWJsaWMgcG9wb3ZlcjogUG9wb3ZlckRpcmVjdGl2ZTtcbiAgICBwdWJsaWMgb25DbG9zZUZyb21PdXRzaWRlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHB1YmxpYyB0b3AgPSAtMTAwMDA7XG4gICAgcHVibGljIGxlZnQgPSAtMTAwMDA7XG4gICAgcHVibGljIGlzSW4gPSBmYWxzZTtcbiAgICBwdWJsaWMgZWZmZWN0aXZlUGxhY2VtZW50OiBzdHJpbmc7XG4gICAgcHVibGljIG9wYWNpdHkgPSAwO1xuICAgIHB1YmxpYyB0cmFuc2l0aW9uRW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgcHVibGljIHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgcHVibGljIHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuICAgIHB1YmxpYyBsaXN0ZW5DbGlja0Z1bmM6IGFueTtcbiAgICBwdWJsaWMgbGlzdGVuTW91c2VGdW5jOiBhbnk7XG4gICAgcHVibGljIGxpc3RlblRvdWNoRnVuYzogYW55O1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFub255bW91c1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIC8qKlxuICAgICAqIENsb3NlcyBkcm9wZG93biBpZiB1c2VyIGNsaWNrcyBvdXRzaWRlIG9mIHRoaXMgZGlyZWN0aXZlLlxuICAgICAqL1xuICAgIHB1YmxpYyBvbkRvY3VtZW50TW91c2VEb3duID0gKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgICAgICBpZiAoIWVsZW1lbnQgfHwgIXRoaXMucG9wb3Zlcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgfHwgdGhpcy5wb3BvdmVyLmdldEVsZW1lbnQoKS5jb250YWlucyhldmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vbkNsb3NlRnJvbU91dHNpZGUuZW1pdCh1bmRlZmluZWQpO1xuICAgIH1cblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBDb25zdHJ1Y3RvclxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gICAgfVxuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIExpZmVjeWNsZSBjYWxsYmFja3NcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5jbG9zZU9uQ2xpY2tPdXRzaWRlKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlbkNsaWNrRnVuYyA9IHRoaXMucmVuZGVyZXIubGlzdGVuKCdkb2N1bWVudCcsICdtb3VzZWRvd24nLCAoZXZlbnQ6IGFueSkgPT4gdGhpcy5vbkRvY3VtZW50TW91c2VEb3duKGV2ZW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2xvc2VPbk1vdXNlT3V0c2lkZSkge1xuICAgICAgICAgICAgdGhpcy5saXN0ZW5Nb3VzZUZ1bmMgPSB0aGlzLnJlbmRlcmVyLmxpc3RlbignZG9jdW1lbnQnLCAnbW91c2VvdmVyJywgKGV2ZW50OiBhbnkpID0+IHRoaXMub25Eb2N1bWVudE1vdXNlRG93bihldmVudCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFsd2F5cyBjbG9zZSBvbiBtb2JpbGUgdG91Y2ggZXZlbnQgb3V0c2lkZS5cbiAgICAgICAgdGhpcy5saXN0ZW5Ub3VjaEZ1bmMgPSB0aGlzLnJlbmRlcmVyLmxpc3RlbignZG9jdW1lbnQnLCAndG91Y2hzdGFydCcsIChldmVudDogYW55KSA9PiB0aGlzLm9uRG9jdW1lbnRNb3VzZURvd24oZXZlbnQpKTtcblxuICAgICAgICB0aGlzLnNob3coKTtcbiAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuY2xvc2VPbkNsaWNrT3V0c2lkZSAmJiB0aGlzLmxpc3RlbkNsaWNrRnVuYykge1xuICAgICAgICAgICAgdGhpcy5saXN0ZW5DbGlja0Z1bmMoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jbG9zZU9uTW91c2VPdXRzaWRlICYmIHRoaXMubGlzdGVuTW91c2VGdW5jKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3Rlbk1vdXNlRnVuYygpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghIXRoaXMubGlzdGVuVG91Y2hGdW5jKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvdWNoRnVuYygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFB1YmxpYyBNZXRob2RzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScsIFsnJGV2ZW50J10pXG4gICAgcHVibGljIG9uUmVzaXplKGV2ZW50KSB7XG4gICAgICAgIHRoaXMud2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgdGhpcy53aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZVBvc2l0aW9uKCk6IHZvaWQge1xuICAgICAgICAvLyBpZiB2aXNpYmxlLCByZXBvc2l0aW9uXG4gICAgICAgIGlmICh0aGlzLm9wYWNpdHkpIHtcbiAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLnBvc2l0aW9uRWxlbWVudHModGhpcy5wb3BvdmVyLmdldEVsZW1lbnQoKSwgdGhpcy5wb3BvdmVyRGl2Lm5hdGl2ZUVsZW1lbnQsIHRoaXMucGxhY2VtZW50KTtcbiAgICAgICAgICAgIHRoaXMudG9wID0gcC50b3A7XG4gICAgICAgICAgICB0aGlzLmxlZnQgPSBwLmxlZnQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc2hvdygpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLnBvcG92ZXIgfHwgIXRoaXMucG9wb3Zlci5nZXRFbGVtZW50KCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHAgPSB0aGlzLnBvc2l0aW9uRWxlbWVudHModGhpcy5wb3BvdmVyLmdldEVsZW1lbnQoKSwgdGhpcy5wb3BvdmVyRGl2Lm5hdGl2ZUVsZW1lbnQsIHRoaXMucGxhY2VtZW50KTtcbiAgICAgICAgdGhpcy50b3AgPSBwLnRvcDtcbiAgICAgICAgdGhpcy5sZWZ0ID0gcC5sZWZ0O1xuICAgICAgICB0aGlzLmlzSW4gPSB0cnVlO1xuICAgICAgICB0aGlzLnRyYW5zaXRpb25FbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vcGFjaXR5ID0gMTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaGlkZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50b3AgPSAtMTAwMDA7XG4gICAgICAgIHRoaXMubGVmdCA9IC0xMDAwMDtcbiAgICAgICAgdGhpcy5pc0luID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wb3BvdmVyLmhpZGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaGlkZUZyb21Qb3BvdmVyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnRvcCA9IC0xMDAwMDtcbiAgICAgICAgdGhpcy5sZWZ0ID0gLTEwMDAwO1xuICAgICAgICB0aGlzLmlzSW4gPSB0cnVlO1xuICAgICAgICB0aGlzLnRyYW5zaXRpb25FbmFibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMub3BhY2l0eSA9IDA7XG4gICAgfVxuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFByb3RlY3RlZCBNZXRob2RzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgcHJvdGVjdGVkIHBvc2l0aW9uRWxlbWVudHMoaG9zdEVsOiBIVE1MRWxlbWVudCwgdGFyZ2V0RWw6IEhUTUxFbGVtZW50LCBwb3NpdGlvblN0cjogUG9wb3ZlclBsYWNlbWVudCwgYXBwZW5kVG9Cb2R5OiBib29sZWFuID0gZmFsc2UpOiB7IHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIgfSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uU3RyUGFydHMgPSAocG9zaXRpb25TdHIgYXMgc3RyaW5nKS5zcGxpdCgnICcpO1xuICAgICAgICBsZXQgcG9zMCA9IHBvc2l0aW9uU3RyUGFydHNbMF07XG4gICAgICAgIGNvbnN0IHBvczEgPSBwb3NpdGlvblN0clBhcnRzWzFdIHx8ICdjZW50ZXInO1xuICAgICAgICBjb25zdCBob3N0RWxQb3MgPSB0aGlzLmFwcGVuZFRvQm9keSB8fCBhcHBlbmRUb0JvZHkgPyB0aGlzLm9mZnNldChob3N0RWwpIDogdGhpcy5wb3NpdGlvbihob3N0RWwpO1xuICAgICAgICBjb25zdCB0YXJnZXRFbFdpZHRoID0gdGFyZ2V0RWwub2Zmc2V0V2lkdGg7XG4gICAgICAgIGNvbnN0IHRhcmdldEVsSGVpZ2h0ID0gdGFyZ2V0RWwub2Zmc2V0SGVpZ2h0O1xuXG4gICAgICAgIHRoaXMuZWZmZWN0aXZlUGxhY2VtZW50ID0gcG9zMCA9IHRoaXMuZ2V0RWZmZWN0aXZlUGxhY2VtZW50KHBvczAsIGhvc3RFbCwgdGFyZ2V0RWwpO1xuXG4gICAgICAgIGNvbnN0IHNoaWZ0V2lkdGg6IGFueSA9IHtcbiAgICAgICAgICAgIGNlbnRlcjogZnVuY3Rpb24gKCk6IG51bWJlciB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhvc3RFbFBvcy5sZWZ0ICsgaG9zdEVsUG9zLndpZHRoIC8gMiAtIHRhcmdldEVsV2lkdGggLyAyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlZnQ6IGZ1bmN0aW9uICgpOiBudW1iZXIge1xuICAgICAgICAgICAgICAgIHJldHVybiBob3N0RWxQb3MubGVmdDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByaWdodDogZnVuY3Rpb24gKCk6IG51bWJlciB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhvc3RFbFBvcy5sZWZ0ICsgaG9zdEVsUG9zLndpZHRoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvcE9yQm90dG9tUmlnaHQ6IGZ1bmN0aW9uICgpOiBudW1iZXIge1xuICAgICAgICAgICAgICAgIHJldHVybiBob3N0RWxQb3MubGVmdCArIGhvc3RFbFBvcy53aWR0aCAvIDI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9wT3JCb3R0b21MZWZ0OiBmdW5jdGlvbiAoKTogbnVtYmVyIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaG9zdEVsUG9zLmxlZnQgLSB0YXJnZXRFbFdpZHRoICArIGhvc3RFbFBvcy53aWR0aCAvIDI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3Qgc2hpZnRIZWlnaHQ6IGFueSA9IHtcbiAgICAgICAgICAgIGNlbnRlcjogZnVuY3Rpb24gKCk6IG51bWJlciB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhvc3RFbFBvcy50b3AgKyBob3N0RWxQb3MuaGVpZ2h0IC8gMiAtIHRhcmdldEVsSGVpZ2h0IC8gMjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b3A6IGZ1bmN0aW9uICgpOiBudW1iZXIge1xuICAgICAgICAgICAgICAgIHJldHVybiBob3N0RWxQb3MudG9wO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJvdHRvbTogZnVuY3Rpb24gKCk6IG51bWJlciB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhvc3RFbFBvcy50b3AgKyBob3N0RWxQb3MuaGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGxldCB0YXJnZXRFbFBvczogeyB0b3A6IG51bWJlciwgbGVmdDogbnVtYmVyIH07XG4gICAgICAgIHN3aXRjaCAocG9zMCkge1xuICAgICAgICAgICAgY2FzZSBQb3BvdmVyUGxhY2VtZW50LlJpZ2h0OlxuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHNoaWZ0SGVpZ2h0W3BvczFdKCksXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHNoaWZ0V2lkdGhbcG9zMF0oKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgUG9wb3ZlclBsYWNlbWVudC5MZWZ0OlxuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHNoaWZ0SGVpZ2h0W3BvczFdKCksXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IGhvc3RFbFBvcy5sZWZ0IC0gdGFyZ2V0RWxXaWR0aFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgUG9wb3ZlclBsYWNlbWVudC5Cb3R0b206XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3MgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogc2hpZnRIZWlnaHRbcG9zMF0oKSxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogc2hpZnRXaWR0aFtwb3MxXSgpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0OlxuICAgICAgICAgICAgICAgIHRhcmdldEVsUG9zID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IGhvc3RFbFBvcy50b3AgLSB0YXJnZXRFbEhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogc2hpZnRXaWR0aFsndG9wT3JCb3R0b21MZWZ0J10oKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ6XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3MgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogaG9zdEVsUG9zLnRvcCAtIHRhcmdldEVsSGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBzaGlmdFdpZHRoWyd0b3BPckJvdHRvbVJpZ2h0J10oKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tTGVmdDpcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBzaGlmdEhlaWdodFtQb3BvdmVyUGxhY2VtZW50LkJvdHRvbV0oKSxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogc2hpZnRXaWR0aFsndG9wT3JCb3R0b21MZWZ0J10oKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tUmlnaHQ6XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxQb3MgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogc2hpZnRIZWlnaHRbUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21dKCksXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHNoaWZ0V2lkdGhbJ3RvcE9yQm90dG9tUmlnaHQnXSgpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0YXJnZXRFbFBvcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBob3N0RWxQb3MudG9wIC0gdGFyZ2V0RWxIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHNoaWZ0V2lkdGhbcG9zMV0oKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGFyZ2V0RWxQb3M7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHBvc2l0aW9uKG5hdGl2ZUVsOiBIVE1MRWxlbWVudCk6IHsgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIgfSB7XG4gICAgICAgIGxldCBvZmZzZXRQYXJlbnRCQ1IgPSB7IHRvcDogMCwgbGVmdDogMCB9O1xuICAgICAgICBjb25zdCBlbEJDUiA9IHRoaXMub2Zmc2V0KG5hdGl2ZUVsKTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0UGFyZW50RWwgPSB0aGlzLnBhcmVudE9mZnNldEVsKG5hdGl2ZUVsKTtcbiAgICAgICAgaWYgKG9mZnNldFBhcmVudEVsICE9PSB3aW5kb3cuZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIG9mZnNldFBhcmVudEJDUiA9IHRoaXMub2Zmc2V0KG9mZnNldFBhcmVudEVsKTtcbiAgICAgICAgICAgIG9mZnNldFBhcmVudEJDUi50b3AgKz0gb2Zmc2V0UGFyZW50RWwuY2xpZW50VG9wIC0gb2Zmc2V0UGFyZW50RWwuc2Nyb2xsVG9wO1xuICAgICAgICAgICAgb2Zmc2V0UGFyZW50QkNSLmxlZnQgKz0gb2Zmc2V0UGFyZW50RWwuY2xpZW50TGVmdCAtIG9mZnNldFBhcmVudEVsLnNjcm9sbExlZnQ7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBib3VuZGluZ0NsaWVudFJlY3QgPSBuYXRpdmVFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHdpZHRoOiBib3VuZGluZ0NsaWVudFJlY3Qud2lkdGggfHwgbmF0aXZlRWwub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGJvdW5kaW5nQ2xpZW50UmVjdC5oZWlnaHQgfHwgbmF0aXZlRWwub2Zmc2V0SGVpZ2h0LFxuICAgICAgICAgICAgdG9wOiBlbEJDUi50b3AgLSBvZmZzZXRQYXJlbnRCQ1IudG9wLFxuICAgICAgICAgICAgbGVmdDogZWxCQ1IubGVmdCAtIG9mZnNldFBhcmVudEJDUi5sZWZ0XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9mZnNldChuYXRpdmVFbDogYW55KTogeyB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgdG9wOiBudW1iZXIsIGxlZnQ6IG51bWJlciB9IHtcbiAgICAgICAgY29uc3QgYm91bmRpbmdDbGllbnRSZWN0ID0gbmF0aXZlRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3aWR0aDogYm91bmRpbmdDbGllbnRSZWN0LndpZHRoIHx8IG5hdGl2ZUVsLm9mZnNldFdpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiBib3VuZGluZ0NsaWVudFJlY3QuaGVpZ2h0IHx8IG5hdGl2ZUVsLm9mZnNldEhlaWdodCxcbiAgICAgICAgICAgIHRvcDogYm91bmRpbmdDbGllbnRSZWN0LnRvcCArICh3aW5kb3cucGFnZVlPZmZzZXQgfHwgd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3ApLFxuICAgICAgICAgICAgbGVmdDogYm91bmRpbmdDbGllbnRSZWN0LmxlZnQgKyAod2luZG93LnBhZ2VYT2Zmc2V0IHx8IHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdClcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0U3R5bGUobmF0aXZlRWw6IEhUTUxFbGVtZW50LCBjc3NQcm9wOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBpZiAoKG5hdGl2ZUVsIGFzIGFueSkuY3VycmVudFN0eWxlKSB7IC8vIElFXG4gICAgICAgICAgICByZXR1cm4gKG5hdGl2ZUVsIGFzIGFueSkuY3VycmVudFN0eWxlW2Nzc1Byb3BdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKSB7XG4gICAgICAgICAgICByZXR1cm4gKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlIGFzIGFueSkobmF0aXZlRWwpW2Nzc1Byb3BdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZmluYWxseSB0cnkgYW5kIGdldCBpbmxpbmUgc3R5bGVcbiAgICAgICAgcmV0dXJuIChuYXRpdmVFbC5zdHlsZSBhcyBhbnkpW2Nzc1Byb3BdO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBpc1N0YXRpY1Bvc2l0aW9uZWQobmF0aXZlRWw6IEhUTUxFbGVtZW50KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAodGhpcy5nZXRTdHlsZShuYXRpdmVFbCwgJ3Bvc2l0aW9uJykgfHwgJ3N0YXRpYycgKSA9PT0gJ3N0YXRpYyc7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHBhcmVudE9mZnNldEVsKG5hdGl2ZUVsOiBIVE1MRWxlbWVudCk6IGFueSB7XG4gICAgICAgIGxldCBvZmZzZXRQYXJlbnQ6IGFueSA9IG5hdGl2ZUVsLm9mZnNldFBhcmVudCB8fCB3aW5kb3cuZG9jdW1lbnQ7XG4gICAgICAgIHdoaWxlIChvZmZzZXRQYXJlbnQgJiYgb2Zmc2V0UGFyZW50ICE9PSB3aW5kb3cuZG9jdW1lbnQgJiYgdGhpcy5pc1N0YXRpY1Bvc2l0aW9uZWQob2Zmc2V0UGFyZW50KSkge1xuICAgICAgICAgICAgb2Zmc2V0UGFyZW50ID0gb2Zmc2V0UGFyZW50Lm9mZnNldFBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2Zmc2V0UGFyZW50IHx8IHdpbmRvdy5kb2N1bWVudDtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3Igb3ZlcmZsb3cgb2YgdGhlIHZpZXdwb3J0IGFuZCByZWZsZWN0IHRoZSBwb3NpdGlvbiBpZiBuZWNlc3NhcnkuXG4gICAgcHJvdGVjdGVkIGdldEVmZmVjdGl2ZVBsYWNlbWVudChwbGFjZW1lbnQ6IHN0cmluZywgaG9zdEVsZW1lbnQ6IEhUTUxFbGVtZW50LCB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGhvc3RFbEJvdW5kaW5nUmVjdCA9IGhvc3RFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgIGNvbnN0IGRlc2lyZWRQbGFjZW1lbnQgPSBwbGFjZW1lbnQgfHwgUG9wb3ZlclBsYWNlbWVudC5Ub3A7XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lcyBpZiBhIHBvcG92ZXIgb3ZlcmZsb3dzIGluIGEgZGlyZWN0aW9uIHdoZW4gaW4gYSBzcGVjaWZpYyBwb3NpdGlvbi5cbiAgICAgICAgY29uc3Qgb3ZlcmZsb3dzID0ge1xuICAgICAgICAgICAgcG9zaXRpb25Ub3A6IHtcbiAgICAgICAgICAgICAgICB0b3A6IGhvc3RFbEJvdW5kaW5nUmVjdC50b3AgLSB0YXJnZXRFbGVtZW50Lm9mZnNldEhlaWdodCA8IDAsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IGhvc3RFbEJvdW5kaW5nUmVjdC5sZWZ0ICsgaG9zdEVsQm91bmRpbmdSZWN0LndpZHRoIC8gMiArIHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGggLyAyID4gdGhpcy53aW5kb3dXaWR0aCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBob3N0RWxCb3VuZGluZ1JlY3QubGVmdCArIGhvc3RFbEJvdW5kaW5nUmVjdC53aWR0aCAvIDIgLSB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoIC8gMiA8IDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3NpdGlvblRvcFJpZ2h0OiB7XG4gICAgICAgICAgICAgICAgdG9wOiBob3N0RWxCb3VuZGluZ1JlY3QudG9wIC0gdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgPCAwLFxuICAgICAgICAgICAgICAgIHJpZ2h0OiBob3N0RWxCb3VuZGluZ1JlY3QucmlnaHQgKyB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoID4gdGhpcy53aW5kb3dXaWR0aFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvc2l0aW9uUmlnaHQ6IHtcbiAgICAgICAgICAgICAgICB0b3A6IGhvc3RFbEJvdW5kaW5nUmVjdC50b3AgKyBob3N0RWxCb3VuZGluZ1JlY3QuaGVpZ2h0IC8gMiAtIHRhcmdldEVsZW1lbnQub2Zmc2V0SGVpZ2h0IC8gMiA8IDAsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IGhvc3RFbEJvdW5kaW5nUmVjdC5yaWdodCArIHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGggPiB0aGlzLndpbmRvd1dpZHRoLFxuICAgICAgICAgICAgICAgIGJvdHRvbTogaG9zdEVsQm91bmRpbmdSZWN0LnRvcCArIGhvc3RFbEJvdW5kaW5nUmVjdC5oZWlnaHQgLyAyICsgdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyID4gdGhpcy53aW5kb3dIZWlnaHRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3NpdGlvbkJvdHRvbVJpZ2h0OiB7XG4gICAgICAgICAgICAgICAgcmlnaHQ6IGhvc3RFbEJvdW5kaW5nUmVjdC5yaWdodCArIHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGggPiB0aGlzLndpbmRvd1dpZHRoLFxuICAgICAgICAgICAgICAgIGJvdHRvbTogaG9zdEVsQm91bmRpbmdSZWN0LmJvdHRvbSArIHRhcmdldEVsZW1lbnQub2Zmc2V0SGVpZ2h0ID4gdGhpcy53aW5kb3dIZWlnaHRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3NpdGlvbkJvdHRvbToge1xuICAgICAgICAgICAgICAgIHJpZ2h0OiBob3N0RWxCb3VuZGluZ1JlY3QubGVmdCArIGhvc3RFbEJvdW5kaW5nUmVjdC53aWR0aCAvIDIgKyB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoIC8gMiA+IHRoaXMud2luZG93V2lkdGgsXG4gICAgICAgICAgICAgICAgYm90dG9tOiBob3N0RWxCb3VuZGluZ1JlY3QuYm90dG9tICsgdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgPiB0aGlzLndpbmRvd0hlaWdodCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBob3N0RWxCb3VuZGluZ1JlY3QubGVmdCArIGhvc3RFbEJvdW5kaW5nUmVjdC53aWR0aCAvIDIgLSB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoIC8gMiA8IDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3NpdGlvbkJvdHRvbUxlZnQ6IHtcbiAgICAgICAgICAgICAgICBib3R0b206IGhvc3RFbEJvdW5kaW5nUmVjdC5ib3R0b20gKyB0YXJnZXRFbGVtZW50Lm9mZnNldEhlaWdodCA+IHRoaXMud2luZG93SGVpZ2h0LFxuICAgICAgICAgICAgICAgIGxlZnQ6IGhvc3RFbEJvdW5kaW5nUmVjdC5sZWZ0IC0gdGFyZ2V0RWxlbWVudC5vZmZzZXRXaWR0aCA8IDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3NpdGlvbkxlZnQ6IHtcbiAgICAgICAgICAgICAgICBsZWZ0OiBob3N0RWxCb3VuZGluZ1JlY3QubGVmdCA8IHRhcmdldEVsZW1lbnQub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICAgICAgdG9wOiBob3N0RWxCb3VuZGluZ1JlY3QudG9wICsgaG9zdEVsQm91bmRpbmdSZWN0LmhlaWdodCAvIDIgLSB0YXJnZXRFbGVtZW50Lm9mZnNldEhlaWdodCAvIDIgPCAwLFxuICAgICAgICAgICAgICAgIGJvdHRvbTogaG9zdEVsQm91bmRpbmdSZWN0LnRvcCArIGhvc3RFbEJvdW5kaW5nUmVjdC5oZWlnaHQgLyAyICsgdGFyZ2V0RWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyID4gdGhpcy53aW5kb3dIZWlnaHRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3NpdGlvblRvcExlZnQ6IHtcbiAgICAgICAgICAgICAgICB0b3A6IGhvc3RFbEJvdW5kaW5nUmVjdC50b3AgLSB0YXJnZXRFbGVtZW50Lm9mZnNldEhlaWdodCA8IDAsXG4gICAgICAgICAgICAgICAgbGVmdDogaG9zdEVsQm91bmRpbmdSZWN0LmxlZnQgLSB0YXJnZXRFbGVtZW50Lm9mZnNldFdpZHRoIDwgMFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuVG9wKSB7XG4gICAgICAgICAgICAvLyBJZiBpdCBvdmVyZmxvd3Mgb24gdGhlIHRvcCBBTkQgbGVmdCwgZ28gdG8gYm90dG9tLXJpZ2h0LlxuICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC50b3AgJiYgb3ZlcmZsb3dzLnBvc2l0aW9uVG9wLmxlZnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21SaWdodDtcblxuICAgICAgICAgICAgLy8gSWYgaXQgb3ZlcmZsb3dzIG9uIHRoZSB0b3AgQU5EIHJpZ2h0LCBnbyB0byBib3R0b20tbGVmdC5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wLnRvcCAmJiBvdmVyZmxvd3MucG9zaXRpb25Ub3AucmlnaHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21MZWZ0O1xuXG4gICAgICAgICAgICAvLyBJZiBpdCBvbmx5IG92ZXJmbG93cyBvbiB0aGUgdG9wLCBnbyB0byBib3R0b20uXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC50b3ApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b207XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG9ubHkgb3ZlcmZsb3dzIHRvIHRoZSByaWdodCwgZ28gdG8gdG9wLWxlZnQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC5yaWdodCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcExlZnQ7XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG9ubHkgb3ZlcmZsb3dzIHRvIHRoZSBsZWZ0LCBnbyB0byB0b3AtcmlnaHQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC5sZWZ0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQpIHtcbiAgICAgICAgICAgIC8vIElmIGl0IG92ZXJmbG93cyBvbiB0aGUgdG9wIEFORCB0aGUgcmlnaHQsIHRyeSBpbiB0aGUgb3JkZXI6IGJvdHRvbSwgQm90dG9tLWxlZnQsIGxlZnQuXG4gICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wUmlnaHQudG9wICYmIG92ZXJmbG93cy5wb3NpdGlvblRvcFJpZ2h0LnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbS5ib3R0b20pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuTGVmdDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbS5yaWdodCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21MZWZ0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG9ubHkgb3ZlcmZsb3dzIG9uIHRoZSB0b3AsIHRyeSBpbiB0aGUgb3JkZXI6IHJpZ2h0LCBib3R0b20tcmlnaHQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcFJpZ2h0LnRvcCkge1xuICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25SaWdodC50b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tUmlnaHQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuUmlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCBvbmx5IG92ZXJmbG93cyBvbiB0aGUgcmlnaHQsIHRyeSBpbiB0aGUgb3JkZXI6IHRvcCwgdG9wLWxlZnQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcFJpZ2h0LnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC5yaWdodCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVzaXJlZFBsYWNlbWVudCA9PT0gUG9wb3ZlclBsYWNlbWVudC5SaWdodCkge1xuICAgICAgICAgICAgLy8gSWYgaXQgb3ZlcmZsb3dzIG9uIHRoZSByaWdodCBBTkQgdGhlIHRvcCwgdHJ5IGluIHRoZSBvcmRlcjogYm90dG9tLXJpZ2h0LCBib3R0b20sIGJvdHRvbS1sZWZ0LlxuICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvblJpZ2h0LnJpZ2h0ICYmIG92ZXJmbG93cy5wb3NpdGlvblJpZ2h0LnRvcCkge1xuICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25Cb3R0b21SaWdodC5yaWdodCAmJiBvdmVyZmxvd3MucG9zaXRpb25Cb3R0b20ucmlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tTGVmdDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbVJpZ2h0LnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21SaWdodDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG92ZXJmbG93cyBvbiB0aGUgcmlnaHQgQU5EIHRoZSBib3R0b20sIHRyeSBpbiB0aGUgb3JkZXI6IHRvcC1yaWdodCwgdG9wLCB0b3AtbGVmdC5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uUmlnaHQucmlnaHQgJiYgb3ZlcmZsb3dzLnBvc2l0aW9uUmlnaHQuYm90dG9tKSB7XG4gICAgICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcFJpZ2h0LnJpZ2h0ICYmIG92ZXJmbG93cy5wb3NpdGlvblRvcC5yaWdodCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wUmlnaHQucmlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcFJpZ2h0O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSWYgaXQgb25seSBvdmVyZmxvd3Mgb24gdGhlIHJpZ2h0LCB0cnkgYWxsIHRvcCBwb3NpdGlvbnMgZnJvbSByaWdodCB0byBsZWZ0LCB0aGVuIHRyeSBhbGwgYm90dG9tIHBvc2l0aW9ucyByaWdodCB0byBsZWZ0LlxuICAgICAgICAgICAgfSBlbHNlIGlmIChvdmVyZmxvd3MucG9zaXRpb25SaWdodC5yaWdodCkge1xuICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25Ub3AudG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25Cb3R0b20ucmlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbUxlZnQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tUmlnaHQucmlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbVJpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC5yaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wTGVmdDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvdmVyZmxvd3MucG9zaXRpb25Ub3BSaWdodC5yaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG9ubHkgb3ZlciBmbG93cyBvbiB0aGUgdG9wLCBnbyBib3R0b20tcmlnaHQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblJpZ2h0LnRvcCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbVJpZ2h0O1xuXG4gICAgICAgICAgICAvLyBJZiBpdCBvbmx5IG92ZXJmbG93cyBvbiB0aGUgYm90dG9tLCBnbyB0b3AtcmlnaHQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblJpZ2h0LmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcFJpZ2h0O1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlJpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tUmlnaHQpIHtcbiAgICAgICAgICAgIC8vIElmIGl0IG92ZXJmbG93cyBvbiB0aGUgYm90dG9tIEFORCB0aGUgcmlnaHQsIHRyeSBpbiB0aGUgb3JkZXI6IHRvcCwgdG9wLWxlZnQsIGxlZnQuXG4gICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tUmlnaHQuYm90dG9tICYmIG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbVJpZ2h0LnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC50b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuTGVmdDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC5yaWdodCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG9ubHkgb3ZlcmZsb3dzIG9uIHRoZSBib3R0b20sIHRyeSBpbiB0aGUgb3JkZXI6IHJpZ2h0LCB0b3AtcmlnaHQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbVJpZ2h0LmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25SaWdodC5ib3R0b20pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuUmlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCBvbmx5IG92ZXJmbG93cyBvbiB0aGUgcmlnaHQsIHRyeSBpbiB0aGUgb3JkZXI6IGJvdHRvbSwgYm90dG9tLWxlZnQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbVJpZ2h0LnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbS5yaWdodCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21MZWZ0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tUmlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVzaXJlZFBsYWNlbWVudCA9PT0gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b20pIHtcbiAgICAgICAgICAgIC8vIElmIGl0IG92ZXJmbG93cyBvbiB0aGUgYm90dG9tIEFORCBsZWZ0LCBnbyB0byB0b3AtcmlnaHQuXG4gICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tLmJvdHRvbSAmJiBvdmVyZmxvd3MucG9zaXRpb25Cb3R0b20ubGVmdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcFJpZ2h0O1xuXG4gICAgICAgICAgICAvLyBJZiBpdCBvdmVyZmxvd3Mgb24gdGhlIGJvdHRvbSBBTkQgcmlnaHQsIGdvIHRvIHRvcC1sZWZ0LlxuICAgICAgICAgICAgfSBlbHNlIGlmIChvdmVyZmxvd3MucG9zaXRpb25Cb3R0b20uYm90dG9tICYmIG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbS5yaWdodCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcExlZnQ7XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG9ubHkgb3ZlcmZsb3dzIG9uIHRoZSBib3R0b20sIGdvIHRvIHRvcC5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tLmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcDtcblxuICAgICAgICAgICAgLy8gSWYgaXQgb25seSBvdmVyZmxvd3MgdG8gdGhlIHJpZ2h0LCBnbyB0byBib3R0b20tbGVmdC5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tLnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tTGVmdDtcblxuICAgICAgICAgICAgLy8gSWYgaXQgb25seSBvdmVyZmxvd3MgdG8gdGhlIGxlZnQsIGdvIHRvIGJvdHRvbS1yaWdodC5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tLmxlZnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21SaWdodDtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b207XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVzaXJlZFBsYWNlbWVudCA9PT0gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21MZWZ0KSB7XG4gICAgICAgICAgICAvLyBJZiBpdCBvdmVyZmxvd3Mgb24gdGhlIGJvdHRvbSBBTkQgdGhlIGxlZnQsIHRyeSBpbiB0aGUgb3JkZXI6IHRvcCwgdG9wLXJpZ2h0LCByaWdodC5cbiAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25Cb3R0b21MZWZ0LmJvdHRvbSAmJiBvdmVyZmxvd3MucG9zaXRpb25Cb3R0b21MZWZ0LmxlZnQpIHtcbiAgICAgICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wLnRvcCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5SaWdodDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcC5sZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcFJpZ2h0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LlRvcDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG9ubHkgb3ZlcmZsb3dzIG9uIHRoZSBib3R0b20sIHRyeSBpbiB0aGUgb3JkZXI6IGxlZnQsIHRvcC1sZWZ0LlxuICAgICAgICAgICAgfSBlbHNlIGlmIChvdmVyZmxvd3MucG9zaXRpb25Cb3R0b21MZWZ0LmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25MZWZ0LmJvdHRvbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkxlZnQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCBvbmx5IG92ZXJmbG93cyBvbiB0aGUgbGVmdCwgdHJ5IGluIHRoZSBvcmRlcjogYm90dG9tLCBib3R0b20tcmlnaHQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbUxlZnQubGVmdCkge1xuICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25Cb3R0b20ubGVmdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21SaWdodDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b207XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbUxlZnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVzaXJlZFBsYWNlbWVudCA9PT0gUG9wb3ZlclBsYWNlbWVudC5MZWZ0KSB7XG4gICAgICAgICAgICAvLyBJZiBpdCBvdmVyZmxvd3Mgb24gdGhlIGxlZnQgQU5EIHRoZSB0b3AsIHRyeSBpbiB0aGUgb3JkZXI6IGJvdHRvbS1sZWZ0LCBib3R0b20sIGJvdHRvbS1yaWdodC5cbiAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25MZWZ0LmxlZnQgJiYgb3ZlcmZsb3dzLnBvc2l0aW9uTGVmdC50b3ApIHtcbiAgICAgICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tTGVmdC5sZWZ0ICYmIG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbS5sZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbVJpZ2h0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tUmlnaHQucmlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbUxlZnQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCBvdmVyZmxvd3Mgb24gdGhlIGxlZnQgQU5EIHRoZSBib3R0b20sIHRyeSBpbiB0aGUgb3JkZXI6IHRvcC1sZWZ0LCB0b3AsIHRvcC1yaWdodC5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uTGVmdC5sZWZ0ICYmIG92ZXJmbG93cy5wb3NpdGlvbkxlZnQuYm90dG9tKSB7XG4gICAgICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcExlZnQubGVmdCAmJiBvdmVyZmxvd3MucG9zaXRpb25Ub3AubGVmdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BSaWdodDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvblRvcExlZnQubGVmdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3A7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wTGVmdDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIElmIGl0IG9ubHkgb3ZlcmZsb3dzIG9uIHRoZSBsZWZ0LCB0cnkgYWxsIHRvcCBwb3NpdGlvbnMgZnJvbSBsZWZ0IHRvIHJpZ2h0LCB0aGVuIHRyeSBhbGwgYm90dG9tIHBvc2l0aW9ucyBsZWZ0IHRvIHJpZ2h0LlxuICAgICAgICAgICAgfSBlbHNlIGlmIChvdmVyZmxvd3MucG9zaXRpb25MZWZ0LmxlZnQpIHtcbiAgICAgICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wLnRvcCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uQm90dG9tLmxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQb3BvdmVyUGxhY2VtZW50LkJvdHRvbVJpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbUxlZnQubGVmdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tTGVmdDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd3MucG9zaXRpb25Ub3AubGVmdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wTGVmdC5sZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3A7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCBvbmx5IG92ZXIgZmxvd3Mgb24gdGhlIHRvcCwgZ28gYm90dG9tLWxlZnQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkxlZnQudG9wKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tTGVmdDtcblxuICAgICAgICAgICAgLy8gSWYgaXQgb25seSBvdmVyZmxvd3Mgb24gdGhlIGJvdHRvbSwgZ28gdG9wLWxlZnQuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkxlZnQuYm90dG9tKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wTGVmdDtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5MZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlc2lyZWRQbGFjZW1lbnQgPT09IFBvcG92ZXJQbGFjZW1lbnQuVG9wTGVmdCkge1xuICAgICAgICAgICAgLy8gSWYgaXQgb3ZlcmZsb3dzIG9uIHRoZSB0b3AgQU5EIHRoZSBsZWZ0LCB0cnkgaW4gdGhlIG9yZGVyOiBib3R0b20sIEJvdHRvbS1yaWdodCwgcmlnaHQuXG4gICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wTGVmdC50b3AgJiYgb3ZlcmZsb3dzLnBvc2l0aW9uVG9wTGVmdC5sZWZ0KSB7XG4gICAgICAgICAgICAgICAgaWYgKG92ZXJmbG93cy5wb3NpdGlvbkJvdHRvbS5ib3R0b20pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuUmlnaHQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvdmVyZmxvd3MucG9zaXRpb25Cb3R0b20ubGVmdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b21SaWdodDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Cb3R0b207XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJZiBpdCBvbmx5IG92ZXJmbG93cyBvbiB0aGUgdG9wLCB0cnkgaW4gdGhlIG9yZGVyOiBsZWZ0LCBib3R0b20tbGVmdC5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wTGVmdC50b3ApIHtcbiAgICAgICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uTGVmdC50b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuQm90dG9tTGVmdDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5MZWZ0O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSWYgaXQgb25seSBvdmVyZmxvd3Mgb24gdGhlIGxlZnQsIHRyeSBpbiB0aGUgb3JkZXI6IHRvcCwgdG9wLXJpZ2h0LlxuICAgICAgICAgICAgfSBlbHNlIGlmIChvdmVyZmxvd3MucG9zaXRpb25Ub3BMZWZ0LmxlZnQpIHtcbiAgICAgICAgICAgICAgICBpZiAob3ZlcmZsb3dzLnBvc2l0aW9uVG9wLmxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wUmlnaHQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcG92ZXJQbGFjZW1lbnQuVG9wO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUG9wb3ZlclBsYWNlbWVudC5Ub3BMZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRlc2lyZWRQbGFjZW1lbnQ7XG4gICAgfVxufVxuIl19